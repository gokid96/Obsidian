Redis는 **인메모리 데이터 저장소**다. 메모리에 저장해서 매우 빠르다.

---

## 주요 용도

| 용도 | 설명 |
|------|------|
| 캐시 | DB 조회 결과 저장, 부하 감소 |
| 세션 저장소 | 여러 서버가 세션 공유 |
| 분산 락 | 동시 작업 방지 |
| 메시지 큐 | Pub/Sub |
| 랭킹 | Sorted Set으로 실시간 순위 |

---

## 자료구조

| 타입 | 설명 | 예시 |
|------|------|------|
| String | 단순 값 | 캐시, 카운터 |
| Hash | 필드-값 쌍 | 사용자 정보 |
| List | 순서 있는 목록 | 최근 본 상품 |
| Set | 중복 없는 집합 | 태그 |
| Sorted Set | 점수로 정렬 | 랭킹 |

---

## 캐시 패턴 (Cache-Aside)

```java
public User getUser(Long userId) {
    // 1. Redis에서 먼저 조회
    String cached = redisTemplate.opsForValue().get("user:" + userId);
    if (cached != null) return parseUser(cached);
    
    // 2. 없으면 DB 조회
    User user = userRepository.findById(userId);
    
    // 3. Redis에 저장
    redisTemplate.opsForValue().set("user:" + userId, toJson(user), Duration.ofMinutes(10));
    return user;
}
```

---

## 분산 락 (Redisson)

```java
RLock lock = redissonClient.getLock("ticket:concert:123");
if (lock.tryLock(3, 5, TimeUnit.SECONDS)) {
    try {
        ticketService.reserve(concertId, userId);
    } finally {
        lock.unlock();
    }
}
```

---

## 재고 감소 (원자적)

```java
Long remaining = redisTemplate.opsForValue().decrement("stock:123");
if (remaining >= 0) {
    // 예약 진행
} else {
    // 품절
}
```

---

## Kafka vs Redis

| | Kafka | Redis |
|--|-------|-------|
| 주 목적 | 이벤트 스트리밍 | 캐시, 빠른 조회 |
| 데이터 보존 | 설정 기간 보관 | 기본 휘발성 |
| 사용 예 | 서비스 간 통신 | DB 앞단 캐시 |

---

## 관련 개념

- [[01. Kafka]]
- [[06. Idempotency (멱등성)]]

---

## Tags

#Redis #캐시 #분산락 #인메모리
