Idempotency(ë©±ë“±ì„±)ëŠ” **ê°™ì€ ìš”ì²­ì„ ì—¬ëŸ¬ ë²ˆ ë³´ë‚´ë„ ê²°ê³¼ê°€ ë™ì¼í•œ ê²ƒ**ì´ë‹¤.
ê²°ì œ, ì£¼ë¬¸, ì¬ê³  ê°™ì€ í•µì‹¬ ë„ë©”ì¸ì—ì„œ ì¤‘ë³µ ì²˜ë¦¬ ë°©ì§€ë¥¼ ìœ„í•´ í•„ìˆ˜.

---

## ë¬¸ì œ ìƒí™©

```
ì‚¬ìš©ì â†’ ê²°ì œ ìš”ì²­ â†’ ì„œë²„ ì²˜ë¦¬ ì™„ë£Œ â†’ ì‘ë‹µ ì¤‘ ë„¤íŠ¸ì›Œí¬ ëŠê¹€
                                        â†“
                              ì‚¬ìš©ì: "ê²°ì œ ì•ˆ ëë‚˜?" ì¬ì‹œë„
                                        â†“
                                    ê²°ì œ 2ë²ˆ ë¨ ğŸ’€
```

---

## í•´ê²°: ë©±ë“±ì„± í‚¤

```
ì²« ë²ˆì§¸ ìš”ì²­: Idempotency-Key: abc-123 â†’ ì²˜ë¦¬ O, ê²°ê³¼ ì €ì¥
ë‘ ë²ˆì§¸ ìš”ì²­: Idempotency-Key: abc-123 â†’ ì´ë¯¸ ì²˜ë¦¬ë¨, ì €ì¥ëœ ê²°ê³¼ ë°˜í™˜
```

---

## êµ¬í˜„ ë°©ë²•

**DB ì €ì¥**
```java
Optional<Payment> existing = paymentRepository.findByIdempotencyKey(key);
if (existing.isPresent()) {
    return existing.get().getResult();  // ì €ì¥ëœ ê²°ê³¼ ë°˜í™˜
}
// ì²˜ë¦¬ í›„ ì €ì¥
```

**Redis SETNX**
```java
Boolean isNew = redisTemplate.opsForValue()
    .setIfAbsent(key, "PROCESSING", Duration.ofHours(24));
if (!isNew) return cached;  // ì´ë¯¸ ì²˜ë¦¬ë¨
```

---

## HTTP ë©”ì„œë“œì™€ ë©±ë“±ì„±

| ë©”ì„œë“œ | ë©±ë“±ì„± | ì„¤ëª… |
|--------|--------|------|
| GET | âœ… | ì¡°íšŒë§Œ |
| PUT | âœ… | ë®ì–´ì”€ |
| DELETE | âœ… | ì´ë¯¸ ì—†ìœ¼ë©´ ì„±ê³µ |
| POST | âŒ | **ë©±ë“±ì„± í‚¤ í•„ìš”** |

---

## Kafka Consumer ë©±ë“±ì„±

```java
@KafkaListener(topics = "order-events")
public void handle(OrderEvent event) {
    if (processedEventRepository.existsById(event.getEventId())) {
        return;  // ì´ë¯¸ ì²˜ë¦¬ë¨
    }
    // ì²˜ë¦¬ í›„ ê¸°ë¡
    processedEventRepository.save(event.getEventId());
}
```

---

## ì–¸ì œ í•„ìš”?

| í•„ìˆ˜ | ì„ íƒ |
|------|------|
| ê²°ì œ, ì†¡ê¸ˆ | ê²Œì‹œê¸€ ì‘ì„± |
| ì£¼ë¬¸ | ëŒ“ê¸€ |
| í¬ì¸íŠ¸ ì ë¦½ | ì¢‹ì•„ìš” |

**ëˆ ê´€ë ¨ = í•„ìˆ˜**

---

## ê´€ë ¨ ê°œë…

- [[03. Outbox Pattern (í•´ê²°ì±…)]]
- [[05. Circuit Breaker Pattern (íšŒë¡œ ì°¨ë‹¨ê¸°)]]

---

## Tags

#Idempotency #ë©±ë“±ì„± #ì¤‘ë³µì²˜ë¦¬ #ë¶„ì‚°ì‹œìŠ¤í…œ
