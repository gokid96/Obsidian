Service Discovery는 **MSA 환경에서 서비스의 위치(IP, 포트)를 자동으로 찾아주는 메커니즘**
Eureka, Consul, Kubernetes DNS 등으로 구현

---

## 왜 필요한가

MSA에서는 서비스 인스턴스가 동적으로 변한다:
- 스케일 아웃으로 인스턴스 추가
- 장애로 IP 변경

**IP 하드코딩하면 망한다.**

---

## 동작 방식

```
┌─────────────────────────────────┐
│       Service Registry          │
│   inventory-service:            │
│     - 192.168.0.10:8080        │
│     - 192.168.0.11:8080        │
└─────────────────────────────────┘
      ▲ 등록              │ 조회
      │                   ▼
┌───────────┐       ┌───────────┐
│ Inventory │       │   Order   │
│  Service  │       │  Service  │
└───────────┘       └───────────┘
```

1. 서비스 시작 → Registry에 등록
2. 주기적으로 heartbeat 전송
3. 호출 시 Registry에서 조회
4. 서비스 종료 → Registry에서 제거

---

## 구현체 비교

| 항목 | Eureka | Consul |
|------|--------|--------|
| 만든 곳 | Netflix | HashiCorp |
| Health Check | 클라이언트가 heartbeat | Consul이 직접 체크 |
| 추가 기능 | 없음 | Config, Key-Value 저장소 |
| 언어 | Java | Go (언어 무관) |

---

## 코드 예시 (Eureka)

```java
// 서비스 이름으로 호출
restTemplate.post("http://inventory-service/deduct", order);
```

```java
@Bean
@LoadBalanced  // 서비스 이름 → IP 변환 + 로드밸런싱
public RestTemplate restTemplate() {
    return new RestTemplate();
}
```

---

## Kubernetes 환경

Kubernetes는 자체 Service Discovery 제공 → **Eureka, Consul 없이도 됨**

```java
restTemplate.post("http://inventory-service:8080/deduct", order);
```

Kubernetes DNS가 알아서 IP 변환 + 로드밸런싱.

---

## 언제 뭘 쓰나

| 상황 | 선택 |
|------|------|
| Spring Cloud 생태계 | Eureka |
| 멀티 언어 환경 | Consul |
| Kubernetes 환경 | K8s DNS (별도 도구 불필요) |

---

## 장단점

| 장점 | 단점 |
|------|------|
| IP 하드코딩 불필요 | Registry 장애 시 문제 |
| 동적 스케일링 대응 | 설정 복잡도 증가 |

---

## 관련 개념

- [[01. Microservices Architecture (기본 개념)]]
- [[02. API Gateway (진입점 관리)]]
- [[05. Circuit Breaker Pattern (회로 차단기)]]

---

## Tags

#ServiceDiscovery #MSA #Eureka #Consul #Kubernetes
