Strangler Fig 패턴은 **모놀리식에서 MSA로 점진적으로 전환하는 방법**이다.

AWS 등 주요 클라우드 벤더에서 권장하는 마이그레이션 패턴이다.

---

## 왜 Strangler Fig

무화과 나무가 다른 나무를 감싸면서 서서히 대체하는 것처럼, 기존 시스템을 서서히 새 시스템으로 교체한다.

```
기존 모놀리식을 한번에 갈아엎지 않고,
기능 하나씩 떼어내서 MSA로 전환
```

---

## 과정

### 1단계: 프록시 추가

모놀리식 앞에 API Gateway를 추가한다.

```
┌──────────┐     ┌─────────┐     ┌──────────────────┐
│  Client  │ ──→ │ Gateway │ ──→ │    모놀리식       │
└──────────┘     └─────────┘     │ (주문,결제,배송)  │
                                 └──────────────────┘
```

### 2단계: 기능 하나씩 분리

결제 기능을 먼저 MSA로 분리한다.

```
┌──────────┐     ┌─────────┐     ┌──────────────────┐
│  Client  │ ──→ │ Gateway │ ──→ │    모놀리식       │
└──────────┘     └────┬────┘     │  (주문, 배송)     │
                      │          └──────────────────┘
                      │
                      └────────→ ┌──────────────────┐
                                 │ payment-service  │ ← 새로 분리
                                 └──────────────────┘
```

### 3단계: 점진적 이전

주문 기능도 분리한다.

```
┌──────────┐     ┌─────────┐     ┌──────────────────┐
│  Client  │ ──→ │ Gateway │ ──→ │    모놀리식       │
└──────────┘     └────┬────┘     │  (배송만 남음)    │
                      │          └──────────────────┘
                      │
                      ├────────→ payment-service
                      └────────→ order-service
```

### 4단계: 완전 전환

모놀리식을 완전히 제거한다.

```
┌──────────┐     ┌─────────┐
│  Client  │ ──→ │ Gateway │
└──────────┘     └────┬────┘
                      │
                      ├────────→ payment-service
                      ├────────→ order-service
                      └────────→ delivery-service
```

---

## 장점

|장점|설명|
|---|---|
|리스크 낮음|한번에 다 바꾸는 게 아니라 점진적|
|롤백 쉬움|문제 생기면 다시 모놀리식으로 라우팅|
|서비스 중단 없음|운영하면서 전환 가능|
|검증 가능|기능별로 테스트 후 전환|

---

## 주의사항

- Gateway가 단일 장애점(SPOF)이 될 수 있음 → 이중화 필요
- 모놀리식과 새 서비스 간 데이터 동기화 고려 필요
- 전환 기간 동안 두 시스템 모두 유지보수해야 함

---

## 관련 개념

- [[01. Microservices Architecture (기본 개념)]]
- [[02. API Gateway (진입점 관리)]]

---
