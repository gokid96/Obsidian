
Service Mesh는 **서비스 간 통신을 인프라 레벨에서 관리하는 계층**
Istio, Linkerd, Consul Connect 등으로 구현

---

## 왜 필요한가

**Service Mesh 없이:** 각 서비스가 직접 구현해야 함:

- 로드밸런싱
- 서비스 디스커버리
- Circuit Breaker
- 인증/암호화
- 로깅/모니터링

```java
// 모든 서비스에 중복 코드
@CircuitBreaker(name = "inventory")
@Retry(name = "inventory")
public void call() { ... }
```

**Service Mesh 있으면:**
통신 관련 기능을 **Sidecar Proxy**가 대신 처리
```
┌─────────────────────┐
│   order-service     │
│  ┌───────────────┐  │
│  │   App Code    │  │  ← 비즈니스 로직만 집중
│  └───────┬───────┘  │
│          │          │
│  ┌───────▼───────┐  │
│  │ Sidecar Proxy │  │  ← 통신 처리 (Envoy)
│  └───────────────┘  │
└─────────────────────┘
```

---

## 구조
```
┌──────────────────────────────────────────────────┐
│                  Control Plane                   │
│              (Istio, Linkerd 등)                 │
│         설정 관리, 정책, 인증서 발급                │
└────────────────────┬─────────────────────────────┘
                     │ 설정 배포
        ┌────────────┼────────────┐
        ▼            ▼            ▼
   ┌─────────┐  ┌─────────┐  ┌─────────┐
   │ Service │  │ Service │  │ Service │
   │ + Proxy │  │ + Proxy │  │ + Proxy │  ← Data Plane
   └─────────┘  └─────────┘  └─────────┘
        ↑            ↑            ↑
        └────────────┴────────────┘
              Proxy 간 통신 (mTLS)
```

---

## 주요 기능

| 기능 | 설명 |
|------|------|
| 트래픽 관리 | 로드밸런싱, 라우팅, Canary 배포 |
| 보안 | mTLS (서비스 간 암호화), 인증/인가 |
| 관측성 | 분산 트레이싱, 메트릭, 로깅 |
| 복원력 | Circuit Breaker, Retry, Timeout |

---

## Sidecar 패턴

모든 서비스 옆에 Proxy(주로 Envoy)가 붙어서 통신 처리
```
요청 흐름:
Client → order-proxy → order-service
                           ↓
             payment-proxy → payment-service
````

애플리케이션 코드 수정 없이 통신 기능 적용.

---

## 주요 도구

|도구|특징|
|---|---|
|Istio|가장 많이 사용, 기능 풍부, 복잡함|
|Linkerd|가볍고 단순, Rust 기반|
|Consul Connect|HashiCorp, Consul과 통합|

---

## Service Mesh vs 라이브러리

| |라이브러리 (Resilience4j 등)|Service Mesh|
|---|---|---|
|적용 방식|코드에 직접 추가|인프라에서 처리|
|언어 종속|Java만|언어 무관|
|변경 시|코드 수정 + 재배포|설정만 변경|
|복잡도|낮음|높음 (K8s 필요)|

---

## 언제 쓰나?

|적합|부적합|
|---|---|
|대규모 MSA (수십 개 이상)|소규모 서비스|
|폴리글랏 환경 (여러 언어)|단일 언어|
|보안/관측성 중요|단순한 구조|

소규모면 라이브러리로 충분. Service Mesh는 오버헤드가 큼.

---

## 장단점

|장점|단점|
|---|---|
|코드 수정 없이 적용|복잡도 증가|
|언어 무관|리소스 오버헤드 (Sidecar)|
|중앙 집중 관리|러닝 커브 높음|

---

## 관련 개념

- [[01. Microservices Architecture (기본 개념)]]
- [[04. Service Discovery (서비스 디스커버리)]]
- [[05. Circuit Breaker Pattern (회로 차단기)]]

---

## Tags

#ServiceMesh #Istio #Linkerd #Sidecar #MSA