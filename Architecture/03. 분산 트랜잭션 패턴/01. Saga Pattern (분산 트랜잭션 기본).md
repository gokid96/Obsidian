Saga 패턴은 **MSA 환경에서 여러 서비스에 걸친 트랜잭션을 관리하는 방법**이다.
서비스마다 DB가 분리되어 있어 하나의 트랜잭션으로 묶을 수 없을 때 사용한다.

---

## 핵심

하나의 긴 트랜잭션을 **여러 로컬 트랜잭션으로 쪼개고**, 실패 시 **보상 트랜잭션으로 롤백**.

```
정상: 주문 → 결제 ✓ → 재고 ✓ → 배송 ✓ → 완료

실패: 주문 → 결제 ✓ → 재고 ✗ (품절)
                ↓
      결제 환불 ← 주문 취소  (보상 트랜잭션)
```

---

## 구현 방식

### Choreography (코레오그래피)
각 서비스가 이벤트 발행 → 다음 서비스가 알아서 반응. 중앙 관리자 없음.

```
order-service → "주문 생성됨" → payment-service → "결제 완료됨" → ...
```

### Orchestration (오케스트레이션)
중앙 Orchestrator가 전체 흐름 제어.

```
┌────────────────┐
│  Orchestrator  │
└───────┬────────┘
    ┌───┼───┬───┐
    ▼   ▼   ▼   ▼
  order payment stock delivery
```

---

## 비교

| | Choreography | Orchestration |
|--|--------------|---------------|
| 중앙 관리자 | 없음 | 있음 |
| 흐름 파악 | 어려움 | 쉬움 |
| 적합한 경우 | 단순한 흐름 | 복잡한 비즈니스 |

---

## 언제 Saga?

**필요:** 여러 서비스가 하나의 비즈니스 트랜잭션 (주문 → 결제 → 재고)
**불필요:** 트랜잭션 보장 안 해도 됨 (알림, 로그, 통계)

---

## 프레임워크

| 프레임워크 | 설명 |
|-----------|------|
| Axon Framework | Java/Spring 기반 |
| Camunda | BPMN 워크플로우 |
| Temporal | 분산 워크플로우 |

---

## 관련 개념

- [[02. CQRS (읽기,쓰기 분리)]]
- [[03. Outbox Pattern (해결책)]]
- [[06. Database per Service (서비스별 DB)]]

---

## Tags

#Saga #분산트랜잭션 #MSA #보상트랜잭션
