


| #   | 컬럼            | 필드                 | 데이터 소스                       | 키/API                                                                                   |
| --- | ------------- | ------------------ | ---------------------------- | --------------------------------------------------------------------------------------- |
| 1   | Service       | `service`          | -                            | 서비스명 (1A1, 1N 등)                                                                        |
| 2   | Type          | `type`             | 로직 판단                        | xaAMR Task + Handler 상태 조합                                                              |
| 3   | Status        | `status`           | 로직 판단                        | xaAMR Task + Handler 상태 조합                                                              |
| 4   | Connected     | `connectedTime`    | **Redis HGET** + **AMR API** | `AirlineMessageHandlerStatus` → `ConnectedTime`<br>`AMR startedTime` -> `ConnectedTime` |
| 5   | Disconnected  | `disconnectedTime` | **Redis HGET**               | `AirlineMessageHandlerStatus` → `DisconnectedTime`                                      |
| 6   | Last Received | `lastReceivedTime` | **Redis HGET**               | `AirlineMessageHandlerStatus` → `LastReceivedTime`                                      |
| 9   | PAXLST        | `paxlstCount`      | **Redis HGET**               | `AirlineMessageHandlerStatus` → `PAXLSTMessageCount`                                    |
| 10  | CUSRES        | `cusresCount`      | **Redis HGET**               | `AirlineMessageHandlerStatus` → `CUSRESMessageCount`                                    |
| 11  | Error         | `errorCount`       | **Redis HGET**               | `AirlineMessageHandlerStatus` → `Reject1MessageCount`                                   |
| 12  | Timeout       | `timeoutCount`     | **Redis HGET**               | `AirlineMessageHandlerStatus` → `Reject2MessageCount`                                   |
| 13  | Processing    | `pendingCount`     | **backend**                  | PAXLST - CUSRES - error - Timeout                                                       |

## Type 결정

---

**현재 테이블에 Stopped 추가:**

| xaAMR MQ | xaAMR MATIP | Redis Handler | Type              | Status    |
| -------- | ----------- | ------------- | ----------------- | --------- |
| Running  | -           | -             | **AMR-MQ**        | Running   |
| Stopped  | -           | -             | **AMR-MQ**        | Stopped   |
| Disabled | -           | 있음            | **Handler-MATIP** | Connected |
| Disabled | -           | 없음            | **AMR-MQ**        | Disabled  |
| -        | Running     | -             | **AMR-MATIP**     | Running   |
| -        | Listening   | -             | **AMR-MATIP**     | Listening |
| -        | Stopped     | -             | **AMR-MATIP**     | Stopped   |
| -        | Disabled    | 있음            | **Handler-MATIP** | Connected |
| -        | Disabled    | 없음            | **AMR-MATIP**     | Disabled  |
| -        | -           | 있음            | **Handler-MATIP** | Connected |

# API 엔드포인트 전체 

## 데이터소스 요약

| 데이터소스          | 유형         | 호스트                    | 용도                          |
| -------------- | ---------- | ---------------------- | --------------------------- |
| `auth`         | PostgreSQL | 192.168.14.31:5010     | 사용자/인증, ARINC 알람            |
| `iapp-kor`     | MySQL      | 192.168.100.151:3306   | 메시지 조회 (APP-PROD)           |
| `pnr-kor`      | MySQL      | 192.168.100.21:3306    | PNR 메시지                     |
| `pfms`         | MySQL      | 192.168.90.151:3306    | PFMS 데이터                    |
| `xaAMR`        | REST API   | 192.168.100.11~13:8443 | xaAMR 시스템                   |
| `SSH`          | SSH        | 192.168.100.11~13:2770 | Handler Config, Immigration |
| `Redis`        | Redis      | 192.168.100.11~13:7399 | Handler 실시간 상태              |
| `Alertmanager` | REST API   | 192.168.14.31:9093     | 알람 전송                       |

---

## 1. Auth API (`/api/auth`)

| Method | Endpoint   | 설명           | 데이터소스             |
| ------ | ---------- | ------------ | ------------------ |
| `POST` | `/login`   | 로그인 (JWT 발급) | PostgreSQL (auth)  |
| `POST` | `/refresh` | 토큰 갱신        | PostgreSQL (auth)  |
| `GET`  | `/me`      | 현재 사용자 정보    | PostgreSQL (auth)  |
| `POST` | `/logout`  | 로그아웃         | - (Stateless)      |

---

## 2. User API (`/api/users`)

| Method   | Endpoint         | 설명        | 데이터소스             |
| -------- | ---------------- | --------- | ------------------ |
| `GET`    | `/`              | 전체 사용자 목록 | PostgreSQL (auth)  |
| `GET`    | `/{id}`          | 사용자 상세 조회 | PostgreSQL (auth)  |
| `POST`   | `/`              | 사용자 생성    | PostgreSQL (auth)  |
| `PUT`    | `/{id}`          | 사용자 수정    | PostgreSQL (auth)  |
| `PUT`    | `/{id}/password` | 비밀번호 변경   | PostgreSQL (auth)  |
| `DELETE` | `/{id}`          | 사용자 삭제    | PostgreSQL (auth)  |

---

## 3. Message API (`/api/messages`)

| Method | Endpoint  | 설명          | 데이터소스            |
| ------ | --------- | ----------- | ---------------- |
| `POST` | `/search` | 메시지 검색 (빠름) | MySQL (iapp-kor) |
| `POST` | `/stats`  | 메시지 통계 (느림) | MySQL (iapp-kor) |

---

## 4. ARINC Integrator API (`/api/arinc-integrator`)

| Method | Endpoint         | 설명                | 데이터소스                            |
| ------ | ---------------- | ----------------- | -------------------------------- |
| `GET`  | `/alarms`        | 알람 목록 조회          | PostgreSQL (auth)                |
| `GET`  | `/alarms/{id}`   | 알람 상세 조회          | PostgreSQL (auth)                |
| `POST` | `/broker-alarms` | Vector 알람 수신      | PostgreSQL (auth) + Alertmanager |
| `GET`  | `/queue-status`  | Alertmanager 큐 상태 | In-Memory (Queue)                |
| `POST` | `/test-alert`    | 테스트 알람 전송         | Alertmanager                     |

---

## 5. Handler API (`/api/handler`)

### Config 관리

| Method | Endpoint               | 설명             | 데이터소스         |
| ------ | ---------------------- | -------------- | ------------- |
| `GET`  | `/config/{server}`     | Config 조회 (파싱) | SSH → YAML 파일 |
| `GET`  | `/config/{server}/raw` | Config 원본 조회   | SSH → YAML 파일 |
| `PUT`  | `/config/{server}/raw` | Config 저장      | SSH → YAML 파일 |

### Process 제어

| Method | Endpoint                                  | 설명         | 데이터소스                     |
| ------ | ----------------------------------------- | ---------- | ------------------------- |
| `GET`  | `/process/{server}/status`                | 전체 프로세스 상태 | SSH (ps 명령어)              |
| `GET`  | `/process/{server}/{serviceName}/status`  | 특정 프로세스 상태 | SSH (ps 명령어)              |
| `POST` | `/process/{server}/{serviceName}/start`   | 프로세스 시작    | SSH (kor-iapp-v3 start)   |
| `POST` | `/process/{server}/{serviceName}/stop`    | 프로세스 중지    | SSH (kor-iapp-v3 stop)    |
| `POST` | `/process/{server}/{serviceName}/restart` | 프로세스 재시작   | SSH (kor-iapp-v3 restart) |

---

## 6. xaAMR API (`/api/xaamr`)

### 시스템 상태

| Method | Endpoint   | 설명        | 데이터소스                             |
| ------ | ---------- | --------- | --------------------------------- |
| `GET`  | `/status`  | 시스템 상태 요약 | xaAMR REST API                    |
| `GET`  | `/process` | 전체 서버 상태  | xaAMR REST API (prod1+prod2+test) |

### MATIP

| Method | Endpoint                   | 설명              | 데이터소스          |
| ------ | -------------------------- | --------------- | -------------- |
| `GET`  | `/matip`                   | MATIP Broker 상태 | xaAMR REST API |
| `GET`  | `/matip/config/{taskName}` | MATIP Task 설정   | xaAMR REST API |

### MQSeries

| Method | Endpoint                       | 설명                 | 데이터소스          |
| ------ | ------------------------------ | ------------------ | -------------- |
| `GET`  | `/mq`                          | MQSeriesToQueue 상태 | xaAMR REST API |
| `GET`  | `/mq-out`                      | QueueToMQSeries 상태 | xaAMR REST API |
| `GET`  | `/mq/config/input/{taskName}`  | MQ 입력 설정           | xaAMR REST API |
| `GET`  | `/mq/config/output/{taskName}` | MQ 출력 설정           | xaAMR REST API |

### Node.js

| Method | Endpoint                          | 설명               | 데이터소스          |
| ------ | --------------------------------- | ---------------- | -------------- |
| `GET`  | `/nodejs-in`                      | QueueToNodeJs 상태 | xaAMR REST API |
| `GET`  | `/nodejs-out`                     | NodejsToQueue 상태 | xaAMR REST API |
| `GET`  | `/scripts/nodejs-to-queue`        | 스크립트 목록          | xaAMR REST API |
| `GET`  | `/scripts/queue-to-nodejs`        | 스크립트 목록          | xaAMR REST API |
| `GET`  | `/scripts/nodejs-to-queue/{name}` | 스크립트 상세          | xaAMR REST API |
| `GET`  | `/scripts/queue-to-nodejs/{name}` | 스크립트 상세          | xaAMR REST API |

### File Tasks

| Method | Endpoint                           | 설명             | 데이터소스          |
| ------ | ---------------------------------- | -------------- | -------------- |
| `GET`  | `/file-to-queue`                   | FileToQueue 상태 | xaAMR REST API |
| `GET`  | `/queue-to-file`                   | QueueToFile 상태 | xaAMR REST API |
| `GET`  | `/file-to-queue/config/{taskName}` | FileToQueue 설정 | xaAMR REST API |
| `GET`  | `/queue-to-file/config/{taskName}` | QueueToFile 설정 | xaAMR REST API |

### Queue 관리

| Method | Endpoint       | 설명          | 데이터소스          |
| ------ | -------------- | ----------- | -------------- |
| `GET`  | `/queues`      | Queue 목록    | xaAMR REST API |
| `GET`  | `/queue-names` | Queue 이름 목록 | xaAMR REST API |

---

## 7. Immigration API (`/api/immigration`)

| Method | Endpoint           | 설명       | 데이터소스        |
| ------ | ------------------ | -------- | ------------ |
| `GET`  | `/status`          | 전체 서버 상태 | SSH (ps 명령어) |
| `GET`  | `/status/{server}` | 특정 서버 상태 | SSH (ps 명령어) |
| `POST` | `/refresh`         | 상태 갱신    | SSH (ps 명령어) |

---

## 8. Settings API (`/api/settings`) 

### 서버 설정

| Method   | Endpoint          | 설명    | 데이터소스            |
| -------- | ----------------- | ----- | ---------------- |
| `GET`    | `/servers`        | 서버 목록 | In-Memory (TODO) |
| `POST`   | `/servers`        | 서버 저장 | In-Memory (TODO) |
| `DELETE` | `/servers/{name}` | 서버 삭제 | In-Memory (TODO) |

### Slack 설정

| Method | Endpoint      | 설명          | 데이터소스            |
| ------ | ------------- | ----------- | ---------------- |
| `GET`  | `/slack`      | Slack 설정 조회 | In-Memory (TODO) |
| `PUT`  | `/slack`      | Slack 설정 저장 | In-Memory (TODO) |
| `POST` | `/slack/test` | 테스트 메시지 전송  | Slack Webhook    |

### 알람 규칙

| Method | Endpoint        | 설명      | 데이터소스           |
| ------ | --------------- | ------- | --------------- |
| `GET`  | `/alert-rules`  | 규칙 목록 조회 | In-Memory (TODO) |
| `POST` | `/alert-rules`  | 규칙 저장   | In-Memory (TODO) |

---

## 9. WebSocket API 

### 연결

| Protocol | Endpoint | 설명                        |
| -------- | -------- | ------------------------- |
| HTTP     | `/ws`    | WebSocket 연결 (SockJS 지원) |

### STOMP 토픽 (실시간 구독)

| 토픽                             | 설명           | 브로드캐스트 주기 | 데이터소스         |
| ------------------------------ | ------------ | --------- | ------------- |
| `/topic/handler/prod1/status`  | PROD1 호스트 상태 | 2초        | Redis + xaAMR |
| `/topic/handler/prod1/summary` | PROD1 요약     | 2초        | Redis + xaAMR |
| `/topic/handler/prod2/status`  | PROD2 호스트 상태 | 2초        | Redis + xaAMR |
| `/topic/handler/prod2/summary` | PROD2 요약     | 2초        | Redis + xaAMR |
| `/topic/handler/test/status`   | TEST 호스트 상태  | 2초        | Redis + xaAMR |
| `/topic/handler/test/summary`  | TEST 요약      | 2초        | Redis + xaAMR |

### WebSocket 데이터 구조

**Status 응답**:
```json
{
  "hosts": [{
    "type": "AMR-MATIP | AMR-MQ | Handler-MATIP",
    "service": "1A1",
    "status": "Running | Connected | Disconnected | Disabled",
    "taskStatus": "Running | A:Running, B:Running",
    "connection": "2024-01-01 10:00:00",
    "handlerConnected": true,
    "matipConnected": true,
    "paxlstCount": 100,
    "cusresCount": 95,
    "errorCount": 3,
    "timeoutCount": 2
  }],
  "count": 25
}
```

**Summary 응답**:
```json
{
  "server": "PROD1",
  "redisConnected": true,
  "immigrationRunning": true,
  "immigrationPid": 12345,
  "totalHosts": 25,
  "connectedHosts": 23,
  "disconnectedHosts": 2,
  "totalPaxlst": 5000,
  "totalCusres": 4800,
  "totalError": 50,
  "totalTimeout": 30,
  "processing": 120,
  "timestamp": "2024-01-01T10:00:00"
}
```

---

## 데이터소스별 요약

| 데이터소스        | 엔드포인트 수 | 용도                           |
| ------------ | ------- | ---------------------------- |
| PostgreSQL   | 12      | 사용자, 인증, 알람                  |
| MySQL        | 2       | 메시지 검색/통계                    |
| xaAMR REST   | 22      | 미들웨어 모니터링                    |
| SSH          | 11      | Config, Process, Immigration |
| Redis        | 6 (WS)  | Handler 실시간 상태               |
| Alertmanager | 2       | 알람 전송                        |
| In-Memory    | 9       | 큐 상태, Settings (TODO)        |
| **총계**       | **64개** | (REST 58개 + WebSocket 6개)    |

