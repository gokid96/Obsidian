## 1. MQ/NoHTH (가장 단순)
```
┌─────────────────────────────────────────────────────────────────┐
│                     항공사 (티웨이, 브루나이)                    │
│                     HITIT DCS 시스템                             │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         │ EDIFACT PAXLST (Plain Text)
                         │ HTH 헤더 없음!
                         ↓
┌─────────────────────────────────────────────────────────────────┐
│                     IBM MQ Server (외부)                         │
│                                                                 │
│  Queue: HITIT.AMX2A.IAPP.KOR                                   │
│         HITIT.TW.IAPP.KOR                                       │
│                                                                 │
│  Message Body:                                                  │
│  UNB+UNOA:4+BI+KIS:ZZ+...                                      │
│  (HTH 헤더 없이 바로 EDIFACT)                                   │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         │ MQ Protocol
                         │
                         ↓
┌─────────────────────────────────────────────────────────────────┐
│         E-border: xaAMR (MQ Listener)                           │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐ │
│  │ Node.js Extension                                         │ │
│  │                                                           │ │
│  │ 1T1.MQSeriesToQueue.js                                   │ │
│  │ TW1.QueueToRedis.js                                      │ │
│  │                                                           │ │
│  │ [처리]                                                    │ │
│  │ 1. MQ 메시지 수신                                         │ │
│  │ 2. Queue 이름으로 ServiceName 식별                       │ │
│  │    (HITIT.xxx → 1T1)                                    │ │
│  │ 3. Redis Queue에 전달                                     │ │
│  └───────────────────────────────────────────────────────────┘ │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ↓
                    Redis Queue
                         │
                         ↓
              Ruby Worker (처리)
                         │
                         ↓
                     법무부
```

**특징:**

- HTH 헤더 없음
- Queue 이름으로 항공사 식별
- 가장 간단한 구조

---

## 2. MQ/HTH (중간 복잡도)

```
┌─────────────────────────────────────────────────────────────────┐
│                     항공사 (일부)                                │
│                     레거시 DCS + MQ 연동                         │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         │ HTH 헤더 + EDIFACT
                         │
                         ↓
┌─────────────────────────────────────────────────────────────────┐
│                     IBM MQ Server (외부)                         │
│                                                                 │
│  Queue: XXX.IAPP.KOR                                           │
│                                                                 │
│  Message Body:                                                  │
│  V.                          ← GFI                             │
│  VHHG.WA/E11TIAPP/I1XAAPPKR  ← HTH 헤더                        │
│  VGYA                                                           │
│  UNB+UNOA:4+BI+KIS:ZZ+...    ← EDIFACT                        │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         │ MQ Protocol
                         │
                         ↓
┌─────────────────────────────────────────────────────────────────┐
│         E-border: xaAMR (MQ Listener)                           │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐ │
│  │ Node.js Extension                                         │ │
│  │                                                           │ │
│  │ XXX.MQSeriesToQueue.js                                   │ │
│  │                                                           │ │
│  │ [처리]                                                    │ │
│  │ 1. MQ 메시지 수신                                         │ │
│  │ 2. HTH 헤더 파싱                                          │ │
│  │    - Source: 11TIAPP (항공사)                           │ │
│  │    - Destination: 1XAAPPKR (E-border)                   │ │
│  │    - TransactionID: P003680                             │ │
│  │ 3. ServiceName 식별                                       │ │
│  │ 4. Redis Queue에 전달                                     │ │
│  └───────────────────────────────────────────────────────────┘ │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ↓
                    Redis Queue
                         │
                         ↓
┌─────────────────────────────────────────────────────────────────┐
│                    Ruby Worker                                  │
│                                                                 │
│  [처리]                                                         │
│  1. HTH 헤더 이미 파싱됨 (Node.js에서)                         │
│  2. EDIFACT 메시지만 검증                                       │
│  3. 법무부로 전달                                               │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ↓
                     법무부
```

**특징:**

- HTH 헤더 포함
- MQ + MATIP 헤더 조합
- Node.js Extension에서 HTH 파싱

---

## 3. MATIP (가장 복잡, 현재 netstat에 없음)

```
┌─────────────────────────────────────────────────────────────────┐
│                     항공사 (아시아나, 델타 등)                   │
│                     레거시 DCS (1980년대)                        │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         │ 전용선/VPN
                         │ MATIP Protocol (Binary)
                         │ Port 9001, 9002, ...
                         ↓
┌─────────────────────────────────────────────────────────────────┐
│         E-border: xaAMR (MATIP Server)                          │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐ │
│  │ Java MATIP Server (Port별 Listener)                      │ │
│  │                                                           │ │
│  │ Port 9001 Listener (1A1)                                 │ │
│  │ Port 9002 Listener (1A2)                                 │ │
│  │ Port 9010 Listener (DL)                                  │ │
│  │                                                           │ │
│  │ [MATIP 처리]                                              │ │
│  │ 1. MATIP SessionOpen 수신                                │ │
│  │ 2. SessionOpenConfirm 응답                               │ │
│  │ 3. MATIP Frame 수신                                       │ │
│  │    - Frame Header 파싱                                   │ │
│  │    - Binary → Text 변환                                  │ │
│  │ 4. HTH 헤더 추출                                          │ │
│  │    V.                                                     │ │
│  │    VHHG.WA/E1SELH7X/I1SELIMMX/P003680                   │ │
│  │    VGYA                                                   │ │
│  │    UNB+UNOA:4+OZ+KIS+...                                │ │
│  │ 5. Port 번호로 ServiceName 식별                          │ │
│  │    (Port 9001 → 1A1)                                    │ │
│  │ 6. ActiveMQ Message 생성                                 │ │
│  └───────────────────────────────────────────────────────────┘ │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         │ 내부 ActiveMQ
                         │
                         ↓
┌─────────────────────────────────────────────────────────────────┐
│         Node.js Extension                                       │
│                                                                 │
│  1A1.QueueToRedis.js                                           │
│                                                                 │
│  [처리]                                                         │
│  1. Java에서 이미 파싱된 메시지 받음                            │
│  2. Redis Queue에 전달                                          │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ↓
                    Redis Queue
                         │
                         ↓
┌─────────────────────────────────────────────────────────────────┐
│                    Ruby Worker                                  │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐ │
│  │ Celluloid Actors                                         │ │
│  │                                                           │ │
│  │ AirlineServerWorker (실제로는 없음, MATIP은 xaAMR이 처리) │ │
│  │                                                           │ │
│  │ AirlineMessageDispatcher                                 │ │
│  │ - Redis에서 brpop                                        │ │
│  │ - 메시지 검증                                            │ │
│  │ - 법무부로 전달                                          │ │
│  │                                                           │ │
│  │ AirlineServerSender                                      │ │
│  │ - 응답 받기                                              │ │
│  │ - HTH 헤더 추가 (역방향)                                 │ │
│  │ - Redis Queue에 넣기                                     │ │
│  └───────────────────────────────────────────────────────────┘ │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ↓
                    Redis Queue
                         │
                         ↓
┌─────────────────────────────────────────────────────────────────┐
│         Node.js Extension                                       │
│                                                                 │
│  1A1.RedisToMATIP.js (추정)                                    │
│                                                                 │
│  [처리]                                                         │
│  1. Redis Queue에서 응답 받기                                   │
│  2. xaAMR에 전달                                                │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ↓
┌─────────────────────────────────────────────────────────────────┐
│         xaAMR (MATIP Server)                                    │
│                                                                 │
│  [MATIP 응답 처리]                                              │
│  1. HTH 헤더 파싱                                               │
│  2. MATIP Frame으로 감싸기                                      │
│  3. Text → Binary 변환                                          │
│  4. Socket으로 전송 (Port 9001)                                │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         │ MATIP Protocol
                         │ 계속 연결 유지 (SessionOpen 상태)
                         ↓
                     항공사
```

**특징:**

- 직접 TCP Socket 연결
- Binary Protocol
- Port별 항공사 구분
- 가장 복잡한 프로토콜 처리
### MQ/NoHTH (티웨이)
``` 
티웨이 DCS 
↓ 
(EDIFACT만) MQ: HITIT.TW.IAPP.KOR 
↓ 
xaAMR (Queue 이름으로 식별) 
↓ 
Redis: TW1 
↓ 
Ruby Worker 
↓ 
법무부 
``` 

### MQ/HTH (일부 항공사)
```
항공사 DCS
↓
(HTH + EDIFACT) MQ: XXX.IAPP.KOR 
↓
xaAMR (HTH 파싱) 
↓ 
Redis: XXX
↓ 
Ruby Worker
↓ 
법무부
```
 ```  ``` ### MATIP (과거 아시아나) 
 ``` 
아시아나 DCS ↓ 
(MATIP Frame + HTH + EDIFACT) xaAMR Port 9001 (Binary 파싱) ↓ 
xaAMR 내부 변환 ↓ 
Redis: 1A1 ↓ 
Ruby Worker ↓ 
법무부
```
