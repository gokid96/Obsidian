```
┌─────────────────────────────────────────────────────────────┐
│  레거시 Summary 쿼리 (21초)                                   │
├─────────────────────────────────────────────────────────────┤
│  SELECT                                                     │
│    COUNT(*),                                                │
│    SUM(CNT_SEGMENT),          ← 인덱스에 없음 (느림)          │
│    SUM(CLEARED_COUNT),        ← 인덱스에 없음 (느림)          │
│    AVG(TIMEDIFF(...))         ← 함수 연산 (느림)             │
│  FROM IAPP_MESSAGES                                         │
│  WHERE ... (314만건 스캔)                                    │
└─────────────────────────────────────────────────────────────┘
```

### 2. 성능 테스트 결과

|쿼리|7일 (314만건)|원인|
|---|---|---|
|COUNT만|**3.6초**|인덱스만 사용 ✅|
|COUNT + RESULT_TYPE별|**3.9초**|인덱스 + 컬럼 1개 ✅|
|+ SUM(CNT_SEGMENT, CLEARED_COUNT)|**20초**|테이블 풀 스캔 ❌|
|+ AVG(TIMEDIFF)|**21초**|함수 연산 추가 ❌|
### 3. 개선 방안: 비동기 분리

```
┌─────────────────────────────────────────────────────────────┐
│  개선된 아키텍처                                              │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  [1] 메인 검색 (4초) - 즉시 표시                              │
│      POST /api/messages/search                              │
│      ├─ 목록 조회 (LIMIT 50)                                │
│      └─ 기본 통계: Total, CUSRES, Error, Timeout            │
│                                                             │
│  [2] 상세 통계 (20초) - 백그라운드 비동기                      │
│      POST /api/messages/stats                               │
│      ├─ Passenger (CNT_SEGMENT, CLEARED_COUNT)              │
│      └─ AvgTime (TIMEDIFF 계산)                             │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

### 4. 사용자 경험 개선

```
검색 버튼 클릭
       │
       ▼ (4초)
┌─────────────────────────────────────────────────────────────┐
│  Total: 3,147,874                                           │
│  CUSRES: 3,147,511 | Error: 15 | Timeout: 348               │
│                                                             │
│  Passenger: ⏳ 로딩중...  |  AvgTime: ⏳ 로딩중...           │
├─────────────────────────────────────────────────────────────┤
│  [테이블 데이터 표시됨]                                       │
└─────────────────────────────────────────────────────────────┘
       │
       ▼ (추가 16초 후, 백그라운드)
┌─────────────────────────────────────────────────────────────┐
│  Total: 3,147,874                                           │
│  CUSRES: 3,147,511 | Error: 15 | Timeout: 348               │
│                                                             │
│  Passenger: 3,334,867 / 4,244,927  |  AvgTime: 0.23 sec     │
└─────────────────────────────────────────────────────────────┘
```

---

### 5. 성능 비교 요약

|항목|레거시|개선 후|개선율|
|---|---|---|---|
|**첫 화면 표시**|27초|**4초**|**85% 단축**|
|전체 통계 완료|27초|20초|26% 단축|
|사용자 체감|27초 대기|4초 후 사용 가능|**즉시 사용**|

---

### 6. 적용 방법 (선택지 비교)

|선택지|설명|채택|
|---|---|---|
|인덱스 추가|운영 DB 변경 필요|❌|
|Summary 제거|기능 축소|❌|
|**비동기 분리**|프론트엔드 로직만 변경|✅ **채택**|
|Redis 캐싱|추가 인프라|❌|
|ElasticSearch|대규모 변경|❌|