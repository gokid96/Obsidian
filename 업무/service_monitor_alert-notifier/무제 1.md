``` ruby
eborder@kor-pnr-test:~/utility/bin$ cat alertmanager
#!/usr/bin/env ruby
require "yaml"
require "daemons"
require "fileutils"

####################

lMessage = <<-MESSAGE
ERROR: no argument given

Usage: alertmanager <service name> <command> or <service name> <server name> <command>

* where <service name> is one of:
  KorPnr <server name> <command>
  KorApp <server name> <command>
  TwnApp <server name> <command>
  KorPfms <server name> <command>

* where <server name> is one of:
  Prod1
  Prod2
  Test

* where <command> is one of:
  start         start an instance of the application
  stop          stop all instances of the application
  restart       stop all instances and restart them afterwards
  status        show status (PID) of application instances

MESSAGE

case lServiceName = ARGV.shift
  when "KorPnr", "KorApp", "TwnApp", "KorPfms"
    case lServerName = ARGV.shift
      when "Prod1", "Prod2", "Test"
    else
      abort "Invalid Server Name."
    end
else
  abort lMessage
end

lCommand = ARGV.shift

unless (["start", "stop", "restart", "status"].include? lCommand)
  abort "Invalid Command"
end

if lServerName
  lServiceName += lServerName
end

####################

BaseFilePath = File.expand_path "../../", __FILE__
ConfigFilePath = File.join BaseFilePath, "config"

LogFilePath = File.join BaseFilePath, "log", "alertmanager"
FileUtils.mkdir_p LogFilePath unless File.directory? LogFilePath

####################
require(File.join(BaseFilePath, "lib", "alertmanagerMonitor"))

options = {
  :app_name   => "alertmanager_#{lServiceName}",
  :ARGV       => [lCommand],
  :dir_mode   => :normal,
  :dir        => File.join(BaseFilePath, 'pid'),
  :multiple   => false,
  :log_output => true,
  :log_dir    => File.join(BaseFilePath, 'bin'),
  :monitor    => true
}

Daemons.run_proc "alertmanager_#{lServiceName}", options do
  puts Time.now

  lConfigData = YAML.load_file File.join(BaseFilePath, "config/alertmanager_#{lServiceName}.conf")

  EBorder.logger = Logger.new File.join(LogFilePath, "alertmanager.log"), "daily"

  lAlertmanagerMonitor = EBorder::AlertmanagerMonitor.new lServiceName, lConfigData

  Signal.trap "TERM" do
    lThread = Thread.start do
      lAlertmanagerMonitor.stop
    end

    lThread.join

    exit
  end

  lAlertmanagerMonitor.start

  sleep
end
```

``` bash
eborder@kor-pnr-test:~/utility/bin$ cat ../config/alertmanager_KorPnrTest.conf
---
ServiceName: KOR-PNR-TEST

# Alertmanager 설정
Alertmanager:
  URL: http://192.168.14.31:9093

# 모니터링 모듈 설정
Modules:
- ModuleFileName: (#ModuleFilePath)/commonConnectionCheck.rb
  ExecuteTime: 00:00-23:55
  Interval: 300
  Parameter:
    SendingServerList:
    - ServerName: USTD-DEV1
      HostName: 192.168.14.31
      PortNumber: 1112

- ModuleFileName: (#ModuleFilePath)/commonDaemonCheck.rb
  Interval: 60
  Parameter:
    ExcludePidCheck:
    - "edifactParser_v2"
    DaemonInfos:
    - DaemonName: xaAMR
      SpecificDaemonNames:
      - "com.arinc.amr.control.nix.Main"
    - DaemonName: httConnector
      HostNames: 1E,BX
    - DaemonName: sabreConnector_1S
    - DaemonName: flightCollectingScheduler
      MonitorStatus: Y
      SpecificDaemonNames:
      - flightCollectingScheduler_v3_kor
    - DaemonName: pnrCollectingScheduler
      MonitorStatus: Y
      SpecificDaemonNames:
      - pnrCollectingScheduler_v3_kor
    - DaemonName: pushPnrManager_v3_kor
      MonitorStatus: Y
    - DaemonName: edifactMessageParser
      MonitorStatus: Y
    - DaemonName: archiveManager
      MonitorStatus: Y
      SpecificDaemonNames: "archiveManager_PnrTest"
    - DaemonName: mysqld
      SpecificDaemonNames: "/usr/sbin/mysqld"
    - DaemonName: serviceMonitor
      MonitorStatus: Y
      SpecificDaemonNames: "serviceMonitor_KorPnrTest"
    - DaemonName: alertmanager
      MonitorStatus: Y
      SpecificDaemonNames: "alertmanager_KorPnrTest"
    - DaemonName: nonexistent_test_service    #TEST
      MonitorStatus: Y
      SpecificDaemonNames: "this_will_never_exist"



- ModuleFileName: (#ModuleFilePath)/commonDailyCheck.rb
  ExecuteTime: 09:00,16:30
  Parameter:
    TimeZone: KST

- ModuleFileName: (#ModuleFilePath)/commonDiskCheck.rb
  Interval: 60
  Parameter:
    FilesystemList:
    - Filesystem: /dev/sda3
      DiskSizeUse: 10
      DiskBackup: Y
    - Filesystem: udev
      DiskSizeUse: 5
    - Filesystem: tmpfs
      DiskSizeUse: 15
    - Filesystem: /dev/sda1
      DiskSizeUse: 5
    - Filesystem: /dev/loop0
      DiskSizeUse: 100
    - Filesystem: /dev/loop1
      DiskSizeUse: 100
    - Filesystem: /dev/loop2
      DiskSizeUse: 100

- ModuleFileName: (#ModuleFilePath)/commonInodeCheck.rb
  Interval: 60
  Parameter:
    FilesystemList:
    - Filesystem: /dev/sda3
      INodesUse: 5
      DiskBackup: Y
    - Filesystem: udev
      INodesUse: 5
    - Filesystem: tmpfs
      INodesUse: 5
    - Filesystem: /dev/sda1
      INodesUse: 5
    - Filesystem: /dev/loop0
      INodesUse: 100
    - Filesystem: /dev/loop1
      INodesUse: 100
    - Filesystem: /dev/loop2
      INodesUse: 100


- ModuleFileName: (#ModuleFilePath)/commonRoutingTableCheck.rb
  Interval: 60
  Parameter:
    RoutingTableList:
    - Destination: 0.0.0.0
      Gateway: 192.168.100.1
      Genmask: 0.0.0.0
      Iface: bond1
    - Destination: 192.168.100.0
      Gateway: 0.0.0.0
      Genmask: 255.255.255.0
      Iface: bond1

- ModuleFileName: (#ModuleFilePath)/commonSessionCheck.rb
  Interval: 60
  Parameter:
    TotalSessionCount: 800
    SessionList:
    - SessionName: xaAMR
      SessionPort: 1617
      SessionCount: 80
      SessionCheck: Over
      Alert: N
    - SessionName: DB
      SessionPort: 3306
      SessionCount: 50
      SessionCheck: Over
      Alert: N

- ModuleFileName: (#ModuleFilePath)/commonNoneProcessFileCheck.rb
  Interval: 60
  Parameter:
    DirectoryList:
    - Directory: /home/eborder/xaAMR/kor/inbound/push
      CreatedTime: 10
    - Directory: /home/eborder/xaAMR/kor/outbound/CIQ
      CreatedTime: 10

- ModuleFileName: (#ModuleFilePath)/pnrPushProcessCheck_v3_kor.rb
  Interval: 300
  Parameter:
    LocalAirportCodeFile: "/home/eborder/pnr/config/localAirportCodes_kor.json"
    DatabaseServer:
      HostName: 127.0.0.1
      PortNumber: 3306
      UserName: eborder
      Password: 2Border@19
      DatabaseName: KOR-PNR
      PollTimeout: 60
    PollingInterval: 10
    ProcessTimeover: 10

- ModuleFileName: (#ModuleFilePath)/pnrLastMessageDateUpdater.rb
  ExecuteTime: 08:00,12:00,16:00
  Parameter:
    ServerName: TEST
    MonitoringDatabaseServer:
      HostName: 192.168.100.151
      PortNumber: 3306
      UserName: eborder
      Password: YhtEborder@6277
      DatabaseName: eborder
      PollTimeout: 60
    PNRDatabaseServer:
      HostName: 127.0.0.1
      PortNumber: 3306
      UserName: eborder
      Password: 2Border@19
      PollTimeout: 60

- ModuleFileName: (#ModuleFilePath)/pnrReport.rb
  ExecuteTime: 08:00,18:00
  Parameter:
    TimeZone: KST
    KorDatabaseServer:
      HostName: 127.0.0.1
      PortNumber: 3306
      UserName: eborder
      Password: 2Border@19
      DatabaseName: KOR-PNR
      PollTimeout: 60
    JpnDatabaseServer:
      HostName: 127.0.0.1
      PortNumber: 3306
      UserName: eborder
      Password: 2Border@19
      DatabaseName: JPN-PNR
      PollTimeout: 60
    MonitorDatabaseServer:
      HostName: 192.168.100.151
      PortNumber: 3306
      UserName: eborder
      Password: YhtEborder@6277
      DatabaseName: eborder
      PollTimeout: 60
    ProcessName:
      U: Job Updater
    ReportInterval:
    ExcludeService:
    - 4V
    - TW
    - JQ
    - VJ
    - ZE
```


