```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              xaAMR (MQ 브로커)                               │
│                           PID: 3726945                                      │
│  ┌─────────────────────┐                    ┌─────────────────────┐        │
│  │  QueueToRedis.js    │                    │  RedisToQueue.js    │        │
│  │  (1A1 서비스)        │                    │  (1A1 서비스)        │        │
│  └─────────────────────┘                    └─────────────────────┘        │
└──────────┬───────────────────────────────────────────▲──────────────────────┘
           │                                           │
           │ LPUSH                                     │ BRPOP
           │                                           │
           ▼                                           │
┌──────────────────────────────────────────────────────┴──────────────────────┐
│                                Redis                                        │
│  ┌──────────────────────────────┐    ┌──────────────────────────────┐      │
│  │ AirlineRequestIDs:Request:1A1│    │ AirlineRequestMessages:1A1   │      │
│  │ (요청 큐)                     │    │ (응답 큐)                     │      │
│  └──────────────────────────────┘    └──────────────────────────────┘      │
└──────────┬───────────────────────────────────────────▲──────────────────────┘
           │                                           │
           │ BRPOP                                     │ LPUSH
           │                                           │
           ▼                                           │
┌─────────────────────────────────────────────────────────────────────────────┐
│                    airlineMessageHandler.rb (Ruby)                          │
│  ┌─────────────────────┐                    ┌─────────────────────┐        │
│  │ AirlineMessage      │                    │ AirlineServer       │        │
│  │ Dispatcher          │ ──── 검증 ────→    │ Sender              │        │
│  │ (요청 처리)          │                    │ (응답 전송)          │        │
│  └─────────────────────┘                    └─────────────────────┘        │
└──────────────────────────────┬──────────────────────▲───────────────────────┘
                               │                      │
                               │ LPUSH                │ BRPOP
                               ▼                      │
┌─────────────────────────────────────────────────────┴───────────────────────┐
│                                Redis                                        │
│                    ┌──────────────────────────────┐                         │
│                    │ AirlineRequestIDs:Request    │                         │
│                    │ (법무부 전송용 큐)            │                         │
│                    └──────────────────────────────┘                         │
└──────────────────────────────┬──────────────────────▲───────────────────────┘
                               │                      │
                               │ BRPOP                │ LPUSH
                               ▼                      │
┌─────────────────────────────────────────────────────────────────────────────┐
│                             법무부 시스템                                    │
│                    (immigrationServer / immigrationClient)                  │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 흐름 요약

| 단계  | 출발                       | 도착                       | 방식      |
| --- | ------------------------ | ------------------------ | ------- |
| 1   | 항공사                      | xaAMR                    | MQ 프로토콜 |
| 2   | QueueToRedis.js          | Redis (요청큐)              | LPUSH   |
| 3   | Redis (요청큐)              | AirlineMessageDispatcher | BRPOP   |
| 4   | AirlineMessageDispatcher | Redis (법무부큐)             | LPUSH   |
| 5   | Redis (법무부큐)             | 법무부                      | BRPOP   |
| 6   | 법무부                      | Redis (응답큐)              | LPUSH   |
| 7   | Redis (응답큐)              | AirlineServerSender      | BRPOP   |
| 8   | AirlineServerSender      | Redis (MQ응답큐)            | LPUSH   |
| 9   | Redis (MQ응답큐)            | RedisToQueue.js          | BRPOP   |
| 10  | xaAMR                    | 항공사                      | MQ 프로토콜 |
```
항공사 (요청: PAXLST)
    │
    ▼
   AMR (MQ 브로커)
    │
    │ onMessage
    ▼
[JS: QueueToRedis] ──LPUSH──→ Redis (AirlineRequestIDs:Request:1A1)
			                                │
			                                │ BRPOP
			                                ▼
			                    [Ruby: AirlineMessageDispatcher]
			                                │
			                                │ 검증
			                                ▼
			                             법무부
			                                │
			                                │ 응답
			                                ▼
			                    [Ruby: AirlineServerSender]
			                                │
			                                │ LPUSH
			                                ▼
[JS: RedisToQueue] ←─BRPOP── Redis (AirlineRequestMessages:1A1)
    │
    │ message.push
    ▼
   AMR (MQ 브로커)
    │
    ▼
항공사 (응답: CUSRES)
```

