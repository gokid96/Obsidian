## 핵심 원칙

**내 서비스의 읽기/쓰기 비율을 먼저 파악하고 최적화 방향을 결정한다**

대부분의 서비스는 읽기가 훨씬 많음 (보통 80~99%)

---

## 서비스 유형별 비율과 전략

### 읽기 중심 (99:1) - 뉴스, 블로그, 문서

```
사용자 행동: 글 읽기 >>> 글 쓰기
```

**최적화 방향**
- 읽기 최적화에 집중
- 캐싱 적극 활용 (TTL 길게)
- CDN으로 정적 콘텐츠 배포
- Read replica 구성

**적용 기술**

|레이어|기술|
|---|---|
|CDN|CloudFront, Cloudflare|
|캐시|Redis (TTL 1시간 이상)|
|DB|Read replica 2~3대|

---

### 읽기 우세 (80:20) - SNS, 커머스

```
사용자 행동: 피드 조회, 상품 검색 >> 게시글 작성, 주문
```

**최적화 방향**

- 읽기 최적화 중심
- 쓰기는 비동기 처리로 응답 속도 확보
- 캐시 무효화 전략 중요

**적용 기술**

|레이어|기술|
|---|---|
|캐시|Redis + Write-invalidate|
|백엔드|메시지 큐로 쓰기 비동기 처리|
|DB|Read replica + 인덱스 최적화|

**예시: 인스타그램 좋아요**

```
1. 좋아요 클릭
2. 즉시 UI 반영 (Optimistic UI)
3. 백그라운드에서 큐로 전송
4. 배치로 DB 업데이트
```

---

### 균형 (50:50) - 채팅, 실시간 게임

```
사용자 행동: 메시지 읽기 ≈ 메시지 보내기
```

**최적화 방향**

- 읽기/쓰기 둘 다 최적화 필요
- CQRS 패턴 고려
- 실시간성 중요 → WebSocket

**적용 기술**

|레이어|기술|
|---|---|
|통신|WebSocket, SSE|
|아키텍처|CQRS (읽기/쓰기 DB 분리)|
|캐시|Redis Pub/Sub|

**CQRS 구조**

```
[쓰기 요청] → Write DB (정규화, 일관성)
                   ↓ 이벤트 동기화
[읽기 요청] ← Read DB (비정규화, 속도)
```

---

### 쓰기 중심 (10:90) - 로그 수집, IoT, 분석

```
사용자 행동: 데이터 수집 >>> 조회
```

**최적화 방향**

- 쓰기 최적화에 집중
- 배치 처리로 대량 쓰기
- 샤딩으로 쓰기 분산
- 인덱스 최소화

**적용 기술**

|레이어|기술|
|---|---|
|수집|Kafka, Kinesis|
|처리|배치 (1000건씩 묶어서)|
|DB|샤딩, 파티셔닝, 시계열 DB|

**예시: 로그 수집 파이프라인**

```
앱 → Kafka → 배치 처리 (1분마다) → DB 벌크 insert
```

---

## 비율 파악 방법

### 1. 로그 분석

```sql
-- API 호출 로그에서 비율 확인
SELECT 
  method,
  COUNT(*) as count,
  COUNT(*) * 100.0 / SUM(COUNT(*)) OVER() as percentage
FROM api_logs
GROUP BY method;
```

### 2. APM 도구

- Datadog, New Relic에서 엔드포인트별 호출 수 확인

### 3. DB 모니터링

```sql
-- MySQL: 읽기/쓰기 비율
SHOW GLOBAL STATUS LIKE 'Com_select';  -- 읽기
SHOW GLOBAL STATUS LIKE 'Com_insert';  -- 쓰기
SHOW GLOBAL STATUS LIKE 'Com_update';  -- 쓰기
```

---

## 트레이드오프

|최적화 방향|장점|단점|
|---|---|---|
|읽기 중심|응답 빠름, 캐시 효율|데이터 일관성 지연|
|쓰기 중심|처리량 높음|읽기 느림, 인덱스 적음|
|CQRS|둘 다 최적화 가능|복잡도 증가, 동기화 비용|

---

## 핵심 요약

1. **비율 먼저 파악** → 로그, APM, DB 모니터링
2. **비율에 따라 전략 선택**
    - 읽기 중심: 캐싱, CDN, replica
    - 쓰기 중심: 배치, 샤딩, 큐
    - 균형: CQRS 고려
3. **트레이드오프 인지** → 완벽한 건 없음