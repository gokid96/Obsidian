## 역할

- 네트워크 트래픽 필터링
- 허용/차단 규칙 기반 통제
- 보안 정책 적용

## 방화벽 유형

### 패킷 필터링 (L3/L4)

- IP, Port, 프로토콜 기반 필터링
- 간단하고 빠름
- 애플리케이션 내용 확인 불가

### Stateful Inspection

- 연결 상태 추적
- 응답 패킷 자동 허용
- 대부분의 현대 방화벽

### Application Firewall (L7)

- HTTP, DNS 등 애플리케이션 레벨 검사
- 더 세밀한 제어
- WAF (Web Application Firewall)

---

## iptables 기본

### 체인 구조

```
PREROUTING → INPUT → [Application] → OUTPUT → POSTROUTING
                ↓                       ↑
            FORWARD ────────────────────┘
```

|체인|역할|
|---|---|
|INPUT|목적지가 로컬인 패킷|
|OUTPUT|출발지가 로컬인 패킷|
|FORWARD|통과하는 패킷 (라우터)|
|PREROUTING|라우팅 전 (DNAT)|
|POSTROUTING|라우팅 후 (SNAT)|

### 기본 명령어

```bash
# 현재 규칙 확인
iptables -L -n -v
iptables -t nat -L -n -v

# 특정 포트 허용
iptables -A INPUT -p tcp --dport 80 -j ACCEPT

# 특정 IP 차단
iptables -A INPUT -s 192.168.1.100 -j DROP

# 상태 기반 허용 (응답 트래픽)
iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT

# 규칙 삭제
iptables -D INPUT -p tcp --dport 80 -j ACCEPT

# 모든 규칙 초기화
iptables -F
```

### NAT 설정 예시

```bash
# SNAT (Masquerade)
iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE

# DNAT (포트 포워딩)
iptables -t nat -A PREROUTING -p tcp --dport 80 -j DNAT --to-destination 192.168.1.100:8080

# IP 포워딩 활성화
echo 1 > /proc/sys/net/ipv4/ip_forward
```

---

## firewalld (CentOS/RHEL 7+)

```bash
# 서비스 허용
firewall-cmd --add-service=http --permanent

# 포트 허용
firewall-cmd --add-port=8080/tcp --permanent

# 포트 포워딩
firewall-cmd --add-forward-port=port=80:proto=tcp:toport=8080 --permanent

# 적용
firewall-cmd --reload

# 확인
firewall-cmd --list-all
```