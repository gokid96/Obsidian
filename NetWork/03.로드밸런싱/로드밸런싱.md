## 로드밸런싱이란?

여러 서버에 트래픽을 분산하여 가용성과 성능을 높이는 기술

```
           ┌─────────────┐
           │ Load        │
Client ───▶│ Balancer    │───┬──▶ Server 1
           │             │   ├──▶ Server 2
           └─────────────┘   └──▶ Server 3
```

---

## L4 vs L7 로드밸런서

### L4 로드밸런서 (Transport Layer)

- **동작 계층**: TCP/UDP (전송 계층)
- **판단 기준**: IP 주소, Port 번호
- **특징**:
    - 패킷 내용을 보지 않음 (빠름)
    - 단순한 분산
    - NAT 방식으로 동작

```
Client → L4 LB → 목적지 IP:Port 기준으로 분산
```

### L7 로드밸런서 (Application Layer)

- **동작 계층**: HTTP/HTTPS (응용 계층)
- **판단 기준**: URL, Header, Cookie, 요청 내용
- **특징**:
    - 패킷 내용 분석 (상대적으로 느림)
    - 세밀한 라우팅 가능
    - SSL Termination 가능

```
Client → L7 LB → /api/* → API 서버
                 /static/* → 정적 파일 서버
                 Cookie: session=abc → 특정 서버 (Sticky)
```

### 비교표

|구분|L4|L7|
|---|---|---|
|속도|빠름|상대적으로 느림|
|판단 기준|IP, Port|URL, Header, Cookie|
|SSL 처리|불가 (Pass-through)|가능 (Termination)|
|세션 유지|IP 해시로 가능|Cookie 기반 Sticky|
|비용|저렴|상대적으로 비쌈|

---

## 로드밸런싱 알고리즘

### 1. Round Robin

- 순서대로 돌아가며 분배
- 가장 단순함
- 서버 성능이 동일할 때 적합

```
요청1 → Server1
요청2 → Server2
요청3 → Server3
요청4 → Server1 (다시 처음부터)
```

### 2. Weighted Round Robin

- 가중치에 따라 분배
- 서버 성능이 다를 때 사용

```
Server1 (weight=3): 3번
Server2 (weight=1): 1번
→ 1,1,1,2,1,1,1,2...
```

### 3. Least Connection

- 현재 연결 수가 가장 적은 서버로 분배
- 연결 시간이 긴 작업에 적합

```
Server1: 10 connections
Server2: 5 connections  ← 새 요청은 여기로
Server3: 8 connections
```

### 4. Weighted Least Connection

- Least Connection + 가중치
- 서버 성능 차이 + 연결 수 고려

### 5. IP Hash

- 클라이언트 IP 해시값으로 서버 결정
- 같은 클라이언트는 항상 같은 서버로 (세션 유지)

```python
server_index = hash(client_ip) % server_count
```

### 6. Least Response Time

- 응답 시간이 가장 빠른 서버로 분배
- 헬스체크와 함께 사용