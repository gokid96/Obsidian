## 3-Way Handshake (연결 설정)

```
Client                         Server
   │                              │
   │──── SYN (seq=x) ────────────▶│  1. 연결 요청
   │                              │
   │◀─── SYN+ACK (seq=y, ack=x+1)─│  2. 요청 수락 + 연결 요청
   │                              │
   │──── ACK (ack=y+1) ──────────▶│  3. 연결 수락
   │                              │
   │        연결 완료 (ESTABLISHED) │
```

### 각 단계 설명

1. **SYN**: 클라이언트가 서버에 연결 요청, 초기 시퀀스 번호(x) 전송
2. **SYN+ACK**: 서버가 요청 수락, 자신의 시퀀스 번호(y) + 클라이언트 확인(x+1)
3. **ACK**: 클라이언트가 서버 확인(y+1), 연결 완료

### 왜 3-way인가?

- 양쪽 모두 송신/수신 가능 확인
- 시퀀스 번호 동기화
- 2-way면 서버가 클라이언트의 수신 능력 확인 불가

## 4-Way Termination (연결 종료)

```
Client                         Server
   │                              │
   │──── FIN ────────────────────▶│  1. 연결 종료 요청
   │                              │
   │◀─── ACK ─────────────────────│  2. 확인
   │                              │
   │◀─── FIN ─────────────────────│  3. 서버도 종료 요청
   │                              │
   │──── ACK ────────────────────▶│  4. 확인
   │                              │
   │      (TIME_WAIT 2MSL)        │
   │                              │
   │        연결 종료              │
```

### 각 단계 설명

1. **FIN (Client→Server)**: 클라이언트가 더 보낼 데이터 없음
2. **ACK (Server→Client)**: 서버가 FIN 수신 확인
3. **FIN (Server→Client)**: 서버도 더 보낼 데이터 없음
4. **ACK (Client→Server)**: 클라이언트가 FIN 수신 확인

### 왜 4-way인가?

- TCP는 양방향 독립적 종료 (Half-Close 지원)
- 서버가 FIN 받아도 보낼 데이터 남아있을 수 있음

## TCP 플래그

|플래그|의미|
|---|---|
|SYN|연결 요청|
|ACK|확인 응답|
|FIN|연결 종료|
|RST|연결 강제 리셋|
|PSH|즉시 전달 (버퍼링 X)|
|URG|긴급 데이터|

## 면접 포인트

- "3-way가 아니라 2-way면 안되나요?" → 양방향 통신 확인 불가
- "4-way가 아니라 3-way면 안되나요?" → Half-Close 지원 때문
- "TIME_WAIT는 왜 필요한가요?" → 지연 패킷 처리, ACK 손실 대비