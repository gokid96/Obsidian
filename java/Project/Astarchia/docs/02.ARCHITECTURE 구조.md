# 시스템 아키텍처

## 전체 구성도
(다이어그램)

## 인프라 구성

### 서버
| 환경 | 구성 | 설명 |
|------|------|------|
| Frontend | Vercel | Next.js SSR |
| Backend | AWS EC2 (t3.micro) | Spring Boot |
| Database | AWS RDS (MySQL) | ... |

### 도메인 & SSL

| 도메인 | 연결 대상 | SSL 처리 |
|--------|----------|----------|
| astarchia.com | Vercel | Vercel 자체 SSL |
| api.astarchia.com | EC2 | Certbot (Let's Encrypt) |

#### Cloudflare 프록시 OFF 선택 이유

초기에는 Cloudflare 프록시를 활성화했으나, API 응답 속도 문제가 발생했습니다.

**문제 상황**
- 클라이언트 대기시간: 521ms
- 원인: Cloudflare 무료 플랜에서 한국 트래픽이 홍콩 서버로 라우팅

**대안 분석**

| 방안 | 속도 | 보안 | 비용 |
|------|------|------|------|
| 프록시 ON 유지 | ❌ ~500ms | ✅ IP 숨김 | 무료 |
| 프록시 OFF + 자체 SSL | ✅ ~50ms | △ IP 노출 | 무료 |
| Argo Smart Routing | ✅ 빠름 | ✅ IP 숨김 | 월 $5+ |

**결정**: 현재 서비스 규모를 고려하여 속도 우선 → 프록시 OFF + EC2 자체 SSL  
**결과**: API 응답 521ms → 47ms (약 91% 개선)

### SSL 인증서 구성
```bash
# Certbot으로 Let's Encrypt 인증서 발급
sudo certbot --nginx -d api.astarchia.com
```

자동 갱신은 systemd timer로 처리됩니다.

## CI/CD
(있다면)