## 직렬화란?

- **객체 → 바이트 스트림** (저장/전송 가능)
- **역직렬화**: 바이트 스트림 → 객체

---

## Serializable
```java
import java.io.Serializable;

public class User implements Serializable {
    private static final long serialVersionUID = 1L;
    
    private String name;
    private int age;
    
    // 생성자, getter, setter
}
```

> [!important] serialVersionUID
> 버전 관리용. 없으면 자동 생성 (클래스 변경 시 문제)

---

## 직렬화 / 역직렬화
```java
User user = new User("Kim", 25);

// 직렬화 (객체 → 파일)
try (ObjectOutputStream oos = new ObjectOutputStream(
        new FileOutputStream("user.dat"))) {
    oos.writeObject(user);
}

// 역직렬화 (파일 → 객체)
try (ObjectInputStream ois = new ObjectInputStream(
        new FileInputStream("user.dat"))) {
    User loaded = (User) ois.readObject();
    System.out.println(loaded.getName());
}
```

---

## transient

### 직렬화 제외
```java
public class User implements Serializable {
    private String name;
    private transient String password;  // 직렬화 제외
    private transient int tempData;     // 직렬화 제외
}
```

역직렬화 시 `null` 또는 기본값

---

## 커스텀 직렬화
```java
public class User implements Serializable {
    private String name;
    private transient String password;
    
    // 직렬화 시 호출
    private void writeObject(ObjectOutputStream oos) throws IOException {
        oos.defaultWriteObject();
        oos.writeObject(encrypt(password));  // 암호화해서 저장
    }
    
    // 역직렬화 시 호출
    private void readObject(ObjectInputStream ois) 
            throws IOException, ClassNotFoundException {
        ois.defaultReadObject();
        this.password = decrypt((String) ois.readObject());
    }
}
```

---

## 주의사항

### 1. 상속 관계
```java
// 부모가 Serializable 아니면
class Parent {
    String parentField;  // 직렬화 안 됨
}

class Child extends Parent implements Serializable {
    String childField;   // 직렬화 됨
}
// 부모는 기본 생성자 필요!
```

### 2. 참조 객체
```java
public class Order implements Serializable {
    private User user;  // User도 Serializable이어야 함!
}
```

### 3. static 필드
```java
public class Config implements Serializable {
    private static String version;  // 직렬화 안 됨 (클래스 소속)
}
```

---

## 실전 예제

### 객체 리스트 저장/로드
```java
// 저장
List<User> users = Arrays.asList(
    new User("Kim", 25),
    new User("Lee", 30)
);

try (ObjectOutputStream oos = new ObjectOutputStream(
        new FileOutputStream("users.dat"))) {
    oos.writeObject(users);
}

// 로드
try (ObjectInputStream ois = new ObjectInputStream(
        new FileInputStream("users.dat"))) {
    List<User> loaded = (List<User>) ois.readObject();
}
```

### 깊은 복사
```java
public static <T extends Serializable> T deepCopy(T obj) throws Exception {
    ByteArrayOutputStream baos = new ByteArrayOutputStream();
    ObjectOutputStream oos = new ObjectOutputStream(baos);
    oos.writeObject(obj);
    
    ByteArrayInputStream bais = new ByteArrayInputStream(baos.toByteArray());
    ObjectInputStream ois = new ObjectInputStream(bais);
    return (T) ois.readObject();
}
```

---

> [!tip] 핵심 정리
> 
> - **Serializable**: 마커 인터페이스
> - **serialVersionUID**: 버전 관리 (명시 권장)
> - **transient**: 직렬화 제외
> - **ObjectOutputStream/ObjectInputStream**: 직렬화/역직렬화

---

#Java #직렬화 #Serializable #IO