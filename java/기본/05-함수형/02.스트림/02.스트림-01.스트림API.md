# 스트림 API (Stream API)

## 스트림이란?
- **데이터 처리 파이프라인**
- 컬렉션/배열을 **함수형**으로 처리
- **지연 연산** + **병렬 처리** 지원
- Java 8+

---

## 스트림 특징

1. **원본 변경 없음**: 새로운 결과 생성
2. **일회용**: 한 번 사용하면 재사용 불가
3. **지연 연산**: 최종 연산 시 실행
4. **내부 반복**: for문 없이 처리

---

## 스트림 생성

### 컬렉션에서
```java
List<String> list = Arrays.asList("A", "B", "C");
Stream<String> stream = list.stream();
```

### 배열에서
```java
String[] arr = {"A", "B", "C"};
Stream<String> stream1 = Arrays.stream(arr);
Stream<String> stream2 = Stream.of("A", "B", "C");
```

### 숫자 범위
```java
IntStream range1 = IntStream.range(1, 5);      // 1,2,3,4
IntStream range2 = IntStream.rangeClosed(1, 5); // 1,2,3,4,5
```

### 무한 스트림
```java
Stream<Integer> infinite = Stream.iterate(0, n -> n + 2);  // 0,2,4,6...
Stream<Double> randoms = Stream.generate(Math::random);
```

### 기본 타입 스트림
```java
IntStream intStream = IntStream.of(1, 2, 3);
LongStream longStream = LongStream.of(1L, 2L, 3L);
DoubleStream doubleStream = DoubleStream.of(1.0, 2.0, 3.0);
```

---

## 스트림 파이프라인

```
생성 → 중간연산 → 중간연산 → ... → 최종연산
```

```java
List<String> result = list.stream()    // 생성
    .filter(s -> s.length() > 3)       // 중간연산
    .map(String::toUpperCase)          // 중간연산
    .sorted()                          // 중간연산
    .collect(Collectors.toList());     // 최종연산
```

---

## 중간 연산

### filter() - 필터링
```java
List<Integer> nums = Arrays.asList(1, 2, 3, 4, 5, 6);

List<Integer> evens = nums.stream()
    .filter(n -> n % 2 == 0)
    .collect(Collectors.toList());  // [2, 4, 6]
```

### map() - 변환
```java
List<String> names = Arrays.asList("kim", "lee", "park");

List<String> uppers = names.stream()
    .map(String::toUpperCase)
    .collect(Collectors.toList());  // [KIM, LEE, PARK]

List<Integer> lengths = names.stream()
    .map(String::length)
    .collect(Collectors.toList());  // [3, 3, 4]
```

### flatMap() - 평탄화
```java
List<List<Integer>> nested = Arrays.asList(
    Arrays.asList(1, 2),
    Arrays.asList(3, 4),
    Arrays.asList(5, 6)
);

List<Integer> flat = nested.stream()
    .flatMap(List::stream)
    .collect(Collectors.toList());  // [1, 2, 3, 4, 5, 6]

// 문자열 단어 분리
List<String> sentences = Arrays.asList("Hello World", "Java Stream");
List<String> words = sentences.stream()
    .flatMap(s -> Arrays.stream(s.split(" ")))
    .collect(Collectors.toList());  // [Hello, World, Java, Stream]
```

### distinct() - 중복 제거
```java
List<Integer> nums = Arrays.asList(1, 2, 2, 3, 3, 3);

List<Integer> unique = nums.stream()
    .distinct()
    .collect(Collectors.toList());  // [1, 2, 3]
```

### sorted() - 정렬
```java
List<String> names = Arrays.asList("Kim", "Lee", "Park");

// 자연 순서
List<String> sorted1 = names.stream()
    .sorted()
    .collect(Collectors.toList());

// 역순
List<String> sorted2 = names.stream()
    .sorted(Comparator.reverseOrder())
    .collect(Collectors.toList());

// 길이순
List<String> sorted3 = names.stream()
    .sorted(Comparator.comparingInt(String::length))
    .collect(Collectors.toList());
```

### limit() / skip()
```java
List<Integer> nums = Arrays.asList(1, 2, 3, 4, 5, 6, 7, 8, 9, 10);

List<Integer> first5 = nums.stream()
    .limit(5)
    .collect(Collectors.toList());  // [1, 2, 3, 4, 5]

List<Integer> skip3 = nums.stream()
    .skip(3)
    .collect(Collectors.toList());  // [4, 5, 6, 7, 8, 9, 10]

// 페이징
List<Integer> page2 = nums.stream()
    .skip(3)
    .limit(3)
    .collect(Collectors.toList());  // [4, 5, 6]
```

### peek() - 디버깅
```java
List<Integer> result = nums.stream()
    .filter(n -> n > 3)
    .peek(n -> System.out.println("필터 통과: " + n))
    .map(n -> n * 2)
    .peek(n -> System.out.println("변환 후: " + n))
    .collect(Collectors.toList());
```

---

## 최종 연산

### collect() - 수집
```java
// List로
List<String> list = stream.collect(Collectors.toList());

// Set으로
Set<String> set = stream.collect(Collectors.toSet());

// Map으로
Map<String, Integer> map = persons.stream()
    .collect(Collectors.toMap(
        Person::getName,   // 키
        Person::getAge     // 값
    ));

// 문자열 결합
String joined = names.stream()
    .collect(Collectors.joining(", "));  // "Kim, Lee, Park"
```

### forEach() - 순회
```java
list.stream().forEach(System.out::println);

// 또는 직접
list.forEach(System.out::println);
```

### count() - 개수
```java
long count = list.stream()
    .filter(s -> s.length() > 3)
    .count();
```

### reduce() - 축소
```java
List<Integer> nums = Arrays.asList(1, 2, 3, 4, 5);

// 합계
int sum = nums.stream()
    .reduce(0, (a, b) -> a + b);  // 15

int sum2 = nums.stream()
    .reduce(0, Integer::sum);

// 최대값
Optional<Integer> max = nums.stream()
    .reduce(Integer::max);
```

### findFirst() / findAny()
```java
Optional<String> first = list.stream()
    .filter(s -> s.startsWith("A"))
    .findFirst();

Optional<String> any = list.stream()
    .filter(s -> s.startsWith("A"))
    .findAny();  // 병렬에서 유용
```

### anyMatch() / allMatch() / noneMatch()
```java
List<Integer> nums = Arrays.asList(1, 2, 3, 4, 5);

boolean hasEven = nums.stream().anyMatch(n -> n % 2 == 0);   // true
boolean allPositive = nums.stream().allMatch(n -> n > 0);    // true
boolean noNegative = nums.stream().noneMatch(n -> n < 0);    // true
```

### min() / max()
```java
Optional<Integer> min = nums.stream().min(Integer::compareTo);
Optional<Integer> max = nums.stream().max(Integer::compareTo);
```

### toArray()
```java
String[] arr = list.stream().toArray(String[]::new);
```

---

## 기본형 스트림

### IntStream, LongStream, DoubleStream
```java
// 합계
int sum = IntStream.of(1, 2, 3, 4, 5).sum();

// 평균
OptionalDouble avg = IntStream.of(1, 2, 3, 4, 5).average();

// 통계
IntSummaryStatistics stats = IntStream.of(1, 2, 3, 4, 5).summaryStatistics();
stats.getSum();      // 15
stats.getAverage();  // 3.0
stats.getMin();      // 1
stats.getMax();      // 5
stats.getCount();    // 5
```

### 변환
```java
// Stream<Integer> → IntStream
IntStream intStream = list.stream().mapToInt(Integer::intValue);

// IntStream → Stream<Integer>
Stream<Integer> boxed = intStream.boxed();
```

---

## Collectors

### 그룹화
```java
Map<String, List<Person>> byCity = persons.stream()
    .collect(Collectors.groupingBy(Person::getCity));

// 그룹별 개수
Map<String, Long> countByCity = persons.stream()
    .collect(Collectors.groupingBy(
        Person::getCity,
        Collectors.counting()
    ));
```

### 분할
```java
Map<Boolean, List<Integer>> partition = nums.stream()
    .collect(Collectors.partitioningBy(n -> n % 2 == 0));
// {true=[2,4,6], false=[1,3,5]}
```

### 통계
```java
int sum = nums.stream().collect(Collectors.summingInt(n -> n));
double avg = nums.stream().collect(Collectors.averagingInt(n -> n));
Optional<Integer> max = nums.stream().collect(Collectors.maxBy(Integer::compareTo));
```

---

## 병렬 스트림

### 생성
```java
// parallelStream()
List<Integer> list = Arrays.asList(1, 2, 3, 4, 5);
list.parallelStream().forEach(System.out::println);

// parallel()
list.stream().parallel().forEach(System.out::println);
```

### 주의사항
```java
// 순서 보장 안 됨
list.parallelStream().forEach(System.out::println);  // 순서 무작위

// 순서 보장
list.parallelStream().forEachOrdered(System.out::println);

// 작은 데이터는 오히려 느림
// 상태 공유 주의
```

---

## 실전 예제

### 상위 3개 추출
```java
List<Integer> top3 = scores.stream()
    .sorted(Comparator.reverseOrder())
    .limit(3)
    .collect(Collectors.toList());
```

### 단어 빈도수
```java
Map<String, Long> wordCount = words.stream()
    .collect(Collectors.groupingBy(
        w -> w,
        Collectors.counting()
    ));
```

### 객체 변환
```java
List<UserDTO> dtos = users.stream()
    .map(user -> new UserDTO(user.getName(), user.getEmail()))
    .collect(Collectors.toList());
```

### 조건별 합계
```java
int adultSum = persons.stream()
    .filter(p -> p.getAge() >= 18)
    .mapToInt(Person::getSalary)
    .sum();
```

---

> [!tip] 핵심 정리
> - **중간 연산**: filter, map, flatMap, sorted, distinct, limit, skip
> - **최종 연산**: collect, forEach, count, reduce, findFirst, anyMatch
> - **collect**: toList, toSet, toMap, groupingBy, joining
> - **기본형 스트림**: IntStream, sum(), average()
> - 원본 변경 안 함, 일회용, 지연 연산

---

#Java #스트림 #Stream #함수형프로그래밍
