# 예외 처리 (Exception Handling)

## 예외란?
- 프로그램 실행 중 발생하는 **비정상적인 상황**
- 예외 처리를 통해 프로그램의 **안정성** 확보

---

## 예외 계층 구조

```
Throwable
├── Error (시스템 오류 - 처리 불가)
│   ├── OutOfMemoryError
│   └── StackOverflowError
│
└── Exception (예외 - 처리 가능)
    ├── RuntimeException (Unchecked)
    │   ├── NullPointerException
    │   ├── ArrayIndexOutOfBoundsException
    │   ├── ArithmeticException
    │   └── ClassCastException
    │
    └── 그 외 Exception (Checked)
        ├── IOException
        ├── SQLException
        └── FileNotFoundException
```

---

## Checked vs Unchecked 예외

| 구분 | Checked | Unchecked |
|------|---------|-----------|
| 상속 | Exception | RuntimeException |
| 컴파일 검사 | O | X |
| 처리 강제 | 필수 | 선택 |
| 예시 | IOException | NullPointerException |

### Checked 예외
```java
// 반드시 처리해야 컴파일 됨
public void readFile() throws IOException {
    FileReader fr = new FileReader("file.txt");
}

// 또는 try-catch
public void readFile() {
    try {
        FileReader fr = new FileReader("file.txt");
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

### Unchecked 예외
```java
// 처리 안 해도 컴파일 됨
public void divide(int a, int b) {
    int result = a / b;  // b가 0이면 ArithmeticException
}
```

---

## try-catch-finally

### 기본 구조
```java
try {
    // 예외 발생 가능 코드
} catch (예외타입 변수) {
    // 예외 처리 코드
} finally {
    // 항상 실행 (선택)
}
```

### 예시
```java
public void divide(int a, int b) {
    try {
        int result = a / b;
        System.out.println("결과: " + result);
    } catch (ArithmeticException e) {
        System.out.println("0으로 나눌 수 없습니다");
    } finally {
        System.out.println("연산 종료");
    }
}

divide(10, 2);  // 결과: 5, 연산 종료
divide(10, 0);  // 0으로 나눌 수 없습니다, 연산 종료
```

---

## 다중 catch

### 여러 예외 처리
```java
try {
    String str = null;
    System.out.println(str.length());  // NullPointerException
    
    int[] arr = new int[5];
    arr[10] = 1;  // ArrayIndexOutOfBoundsException
    
} catch (NullPointerException e) {
    System.out.println("null 참조 오류");
} catch (ArrayIndexOutOfBoundsException e) {
    System.out.println("배열 인덱스 오류");
} catch (Exception e) {
    System.out.println("기타 오류: " + e.getMessage());
}
```

### 멀티 catch (Java 7+)
```java
try {
    // 예외 발생 코드
} catch (NullPointerException | ArrayIndexOutOfBoundsException e) {
    System.out.println("참조 오류: " + e.getMessage());
}
```

### catch 순서 주의
```java
// 잘못된 순서 - 컴파일 에러
try {
    // ...
} catch (Exception e) {  // 상위 예외가 먼저 오면 안 됨
    // ...
} catch (IOException e) {  // 도달 불가
    // ...
}

// 올바른 순서 - 하위 예외부터
try {
    // ...
} catch (IOException e) {
    // ...
} catch (Exception e) {
    // ...
}
```

---

## finally 블록

### 항상 실행
```java
public void example() {
    try {
        System.out.println("try");
        return;  // return 있어도
    } catch (Exception e) {
        System.out.println("catch");
    } finally {
        System.out.println("finally");  // 실행됨!
    }
}
// 출력: try, finally
```

### 리소스 정리
```java
FileInputStream fis = null;
try {
    fis = new FileInputStream("file.txt");
    // 파일 읽기
} catch (IOException e) {
    e.printStackTrace();
} finally {
    if (fis != null) {
        try {
            fis.close();  // 리소스 해제
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
```

---

## try-with-resources (Java 7+)

### AutoCloseable 자동 해제
```java
// 기존 방식 (복잡)
FileInputStream fis = null;
try {
    fis = new FileInputStream("file.txt");
} finally {
    if (fis != null) fis.close();
}

// try-with-resources (간결)
try (FileInputStream fis = new FileInputStream("file.txt")) {
    // 파일 읽기
}  // 자동으로 close() 호출
```

### 여러 리소스
```java
try (
    FileInputStream fis = new FileInputStream("input.txt");
    FileOutputStream fos = new FileOutputStream("output.txt")
) {
    // 파일 복사
}  // 둘 다 자동 close
```

---

## throws - 예외 떠넘기기

### 메서드에서 예외 선언
```java
public void readFile(String path) throws IOException {
    FileReader fr = new FileReader(path);
    // ...
}

// 호출하는 쪽에서 처리
public void main() {
    try {
        readFile("test.txt");
    } catch (IOException e) {
        System.out.println("파일 읽기 실패");
    }
}
```

### 여러 예외
```java
public void method() throws IOException, SQLException {
    // ...
}
```

---

## throw - 예외 발생시키기

### 예외 던지기
```java
public void setAge(int age) {
    if (age < 0) {
        throw new IllegalArgumentException("나이는 음수가 될 수 없습니다");
    }
    this.age = age;
}
```

### 예외 다시 던지기
```java
public void method() {
    try {
        // ...
    } catch (Exception e) {
        // 로깅 후 다시 던지기
        System.out.println("예외 발생: " + e.getMessage());
        throw e;
    }
}
```

---

## 사용자 정의 예외

### 예외 클래스 생성
```java
// Checked 예외
public class InsufficientBalanceException extends Exception {
    private int balance;
    
    public InsufficientBalanceException(String message, int balance) {
        super(message);
        this.balance = balance;
    }
    
    public int getBalance() {
        return balance;
    }
}

// Unchecked 예외
public class InvalidUserException extends RuntimeException {
    public InvalidUserException(String message) {
        super(message);
    }
}
```

### 사용
```java
public void withdraw(int amount) throws InsufficientBalanceException {
    if (amount > balance) {
        throw new InsufficientBalanceException(
            "잔액이 부족합니다", balance);
    }
    balance -= amount;
}

// 호출
try {
    account.withdraw(10000);
} catch (InsufficientBalanceException e) {
    System.out.println(e.getMessage());
    System.out.println("현재 잔액: " + e.getBalance());
}
```

---

## 예외 정보 얻기

### 주요 메서드
```java
try {
    int result = 10 / 0;
} catch (ArithmeticException e) {
    // 예외 메시지
    System.out.println(e.getMessage());  // "/ by zero"
    
    // 예외 종류 + 메시지
    System.out.println(e.toString());
    
    // 스택 트레이스 출력
    e.printStackTrace();
    
    // 원인 예외
    Throwable cause = e.getCause();
}
```

---

## 예외 처리 모범 사례

### 1. 구체적인 예외 catch
```java
// 나쁜 예
try {
    // ...
} catch (Exception e) { }

// 좋은 예
try {
    // ...
} catch (FileNotFoundException e) {
    // 파일 없음 처리
} catch (IOException e) {
    // IO 오류 처리
}
```

### 2. 예외 무시하지 않기
```java
// 나쁜 예
try {
    // ...
} catch (Exception e) {
    // 아무것도 안 함
}

// 좋은 예
try {
    // ...
} catch (Exception e) {
    log.error("오류 발생", e);
    throw new RuntimeException(e);
}
```

### 3. 적절한 수준에서 처리
```java
// 처리할 수 있는 곳에서 처리
// 처리할 수 없으면 상위로 전파
```

---

> [!tip] 핵심 정리
> - **try-catch-finally**: 예외 처리 기본 구조
> - **try-with-resources**: 리소스 자동 해제
> - **throws**: 예외 떠넘기기 (메서드 선언)
> - **throw**: 예외 발생시키기
> - Checked 예외: 처리 필수
> - Unchecked 예외: 처리 선택

---

#Java #예외처리 #Exception #try-catch #자바핵심
