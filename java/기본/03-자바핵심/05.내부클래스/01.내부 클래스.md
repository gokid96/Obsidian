# 내부 클래스 (Inner Class)

## 내부 클래스란?
- 클래스 **내부에 선언된 클래스**
- 외부 클래스의 멤버에 쉽게 접근
- 캡슐화 강화

---

## 내부 클래스 종류

| 종류 | 선언 위치 | 특징 |
|------|----------|------|
| 멤버 내부 클래스 | 멤버 위치 | 외부 인스턴스 필요 |
| 정적 내부 클래스 | 멤버 위치 (static) | 외부 인스턴스 불필요 |
| 지역 내부 클래스 | 메서드 내부 | 메서드 내에서만 사용 |
| 익명 내부 클래스 | 메서드 내부 | 일회용, 이름 없음 |

---

## 멤버 내부 클래스 (인스턴스)

### 정의
```java
public class Outer {
    private int outerField = 10;
    
    // 멤버 내부 클래스
    public class Inner {
        private int innerField = 20;
        
        public void display() {
            // 외부 클래스 멤버 접근 가능
            System.out.println("outerField: " + outerField);
            System.out.println("innerField: " + innerField);
        }
    }
}
```

### 사용
```java
// 외부 객체 먼저 생성
Outer outer = new Outer();

// 내부 객체 생성
Outer.Inner inner = outer.new Inner();
inner.display();

// 한 줄로
Outer.Inner inner2 = new Outer().new Inner();
```

### 외부 클래스 참조
```java
public class Outer {
    private int value = 10;
    
    public class Inner {
        private int value = 20;
        
        public void show() {
            int value = 30;
            
            System.out.println(value);            // 30 (지역)
            System.out.println(this.value);       // 20 (내부)
            System.out.println(Outer.this.value); // 10 (외부)
        }
    }
}
```

---

## 정적 내부 클래스 (static)

### 정의
```java
public class Outer {
    private static int staticField = 10;
    private int instanceField = 20;
    
    // 정적 내부 클래스
    public static class StaticInner {
        public void display() {
            // static 멤버만 접근 가능
            System.out.println("staticField: " + staticField);
            // System.out.println(instanceField);  // 에러!
        }
    }
}
```

### 사용
```java
// 외부 객체 없이 생성 가능
Outer.StaticInner inner = new Outer.StaticInner();
inner.display();
```

### 활용: 빌더 패턴
```java
public class Person {
    private final String name;
    private final int age;
    private final String email;
    
    private Person(Builder builder) {
        this.name = builder.name;
        this.age = builder.age;
        this.email = builder.email;
    }
    
    public static class Builder {
        private String name;
        private int age;
        private String email;
        
        public Builder name(String name) {
            this.name = name;
            return this;
        }
        
        public Builder age(int age) {
            this.age = age;
            return this;
        }
        
        public Builder email(String email) {
            this.email = email;
            return this;
        }
        
        public Person build() {
            return new Person(this);
        }
    }
}

// 사용
Person person = new Person.Builder()
    .name("홍길동")
    .age(25)
    .email("hong@email.com")
    .build();
```

---

## 지역 내부 클래스

### 메서드 내부에 선언
```java
public class Outer {
    public void method() {
        int localVar = 10;  // effectively final
        
        // 지역 내부 클래스
        class LocalInner {
            public void display() {
                System.out.println("localVar: " + localVar);
            }
        }
        
        LocalInner inner = new LocalInner();
        inner.display();
    }
}
```

### 제한 사항
```java
public void method() {
    int localVar = 10;
    // localVar = 20;  // 변경하면 내부 클래스에서 사용 불가
    
    class LocalInner {
        void test() {
            System.out.println(localVar);  // effectively final만 접근
        }
    }
}
```

---

## 익명 내부 클래스

### 클래스 정의 + 인스턴스 생성 동시에
```java
// 추상 클래스 익명 구현
abstract class Animal {
    abstract void sound();
}

Animal dog = new Animal() {
    @Override
    void sound() {
        System.out.println("멍멍!");
    }
};
dog.sound();
```

### 인터페이스 익명 구현
```java
interface Greeting {
    void greet();
}

Greeting hello = new Greeting() {
    @Override
    public void greet() {
        System.out.println("Hello!");
    }
};
hello.greet();
```

### 람다로 대체 (Java 8+)
```java
// 익명 클래스
Runnable r1 = new Runnable() {
    @Override
    public void run() {
        System.out.println("Running");
    }
};

// 람다
Runnable r2 = () -> System.out.println("Running");
```

### 이벤트 리스너
```java
button.addActionListener(new ActionListener() {
    @Override
    public void actionPerformed(ActionEvent e) {
        System.out.println("Button clicked!");
    }
});

// 람다
button.addActionListener(e -> System.out.println("Button clicked!"));
```

---

## 내부 클래스 선택 가이드

### 멤버 내부 클래스
- 외부 클래스의 **인스턴스 멤버**에 접근 필요
- 외부 객체와 **강하게 연관**

```java
class LinkedList {
    private Node head;
    
    class Node {  // LinkedList 인스턴스에 종속
        int data;
        Node next;
    }
}
```

### 정적 내부 클래스
- 외부 인스턴스 **불필요**
- **독립적**으로 사용 가능
- 빌더, 헬퍼 클래스

```java
class Calculator {
    static class Result {  // 독립적
        int value;
        String message;
    }
}
```

### 익명 내부 클래스
- **일회용** 구현
- 짧은 코드
- 콜백, 이벤트 처리

```java
Collections.sort(list, new Comparator<String>() {
    @Override
    public int compare(String a, String b) {
        return a.length() - b.length();
    }
});
```

---

## 실전 예제

### Iterator 구현
```java
public class MyList<T> implements Iterable<T> {
    private Object[] elements;
    private int size;
    
    @Override
    public Iterator<T> iterator() {
        return new MyIterator();
    }
    
    // 멤버 내부 클래스로 Iterator 구현
    private class MyIterator implements Iterator<T> {
        private int cursor = 0;
        
        @Override
        public boolean hasNext() {
            return cursor < size;
        }
        
        @Override
        @SuppressWarnings("unchecked")
        public T next() {
            return (T) elements[cursor++];
        }
    }
}
```

### Comparator 익명 클래스
```java
List<String> names = Arrays.asList("Kim", "Lee", "Park", "Choi");

// 익명 클래스
Collections.sort(names, new Comparator<String>() {
    @Override
    public int compare(String a, String b) {
        return a.length() - b.length();
    }
});

// 람다
Collections.sort(names, (a, b) -> a.length() - b.length());

// 메서드 참조
names.sort(Comparator.comparingInt(String::length));
```

---

> [!tip] 핵심 정리
> - **멤버 내부**: 외부 인스턴스 필요, 외부 멤버 접근
> - **정적 내부**: static, 외부 인스턴스 불필요
> - **지역 내부**: 메서드 내부, effectively final만 접근
> - **익명 내부**: 일회용, 람다로 대체 가능
> - `Outer.this`: 외부 클래스 참조
> - `outer.new Inner()`: 내부 클래스 생성

---

#Java #내부클래스 #InnerClass #익명클래스 #자바핵심
