## 동시성 제어 정리

### 1. 문제 상황

여러 사용자/스레드가 **동시에 같은 자원**을 수정할 때 충돌 발생

---

### 2. 해결 방법

| 방법               | 레벨          | 동작 방식                 | 사용처         |
| ---------------- | ----------- | --------------------- | ----------- |
| **synchronized** | JVM (단일 서버) | 한 스레드씩 순차 실행          | 메모리 내 공유 자원 |
| **낙관적 락**        | 애플리케이션/DB   | 저장 시 버전 비교, 다르면 거부    | 충돌 적은 경우    |
| **비관적 락**        | DB          | 읽을 때부터 락, 끝날 때까지 대기   | 충돌 많은 경우    |
| **분산 락**         | 여러 서버       | Redis/Zookeeper로 전역 락 | 다중 서버 인스턴스  |
| **트랜잭션**         | DB          | 여러 작업을 하나로 묶음 (원자성)   | DB 작업       |

---

### 3. 트랜잭션 vs 락

```
트랜잭션 = 원자성 (다 되거나, 다 안되거나)
락      = 충돌 방지 (동시 수정 막기)

→ 서로 다른 문제 해결, 필요하면 둘 다 사용
```


### 4. 선택 기준

```
충돌 빈도 낮음 → 낙관적 락
충돌 빈도 높음 → 비관적 락
단일 서버      → synchronized 가능
다중 서버      → 분산 락 필요
DB 작업       → 트랜잭션 + 락 조합
파일/외부 API  → 직접 구현
```

### 5. 실무 예시

| 상황            | 선택           | 이유                      |
| ------------- | ------------ | ----------------------- |
| 게시글 수정        | 트랜잭션 + 낙관적 락 | 동시 수정 드묾, 충돌 시 다시 작성 가능 |
| 재고 차감         | 트랜잭션 + 비관적 락 | 동시 주문 많음, 재고 음수 되면 안됨   |
| 설정 파일 편집      | 낙관적 락 직접 구현  | DB 아님, 편집 빈도 낮음         |
| 결제 처리 (다중 서버) | 분산 락         | 여러 서버에서 동시 요청, 중복 결제 방지 |
