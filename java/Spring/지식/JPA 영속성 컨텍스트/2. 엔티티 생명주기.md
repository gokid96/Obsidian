## 엔티티 생명주기 개요

JPA에서 엔티티는 4가지 주요 상태를 가집니다:

1. 비영속(New)
2. 영속(Managed)
3. 준영속(Detached)
4. 삭제(Removed)

## 1. 비영속 상태 (New)

### 정의

- 엔티티 객체를 생성했지만 영속성 컨텍스트에 저장되지 않은 상태
- 데이터베이스와 전혀 연관되지 않은 상태

### 예시 코드

```java
// 비영속 상태 - 순수한 객체 상태
Member member = new Member();
member.setId(1L);
member.setName("홍길동");
```

## 2. 영속 상태 (Managed)

### 정의

- 엔티티가 영속성 컨텍스트에 저장된 상태
- 영속성 컨텍스트가 해당 엔티티를 관리

### 예시 코드

```java
EntityManager entityManager = entityManagerFactory.createEntityManager();
EntityTransaction transaction = entityManager.getTransaction();

transaction.begin();

// 비영속 상태 → 영속 상태로 전환
Member member = new Member();
member.setId(1L);
member.setName("홍길동");

// persist() 메서드로 영속 상태 만듦
entityManager.persist(member);

transaction.commit();
```

### 특징

- 1차 캐시에 저장
- 변경 감지(Dirty Checking) 대상
- 트랜잭션 커밋 시 데이터베이스에 반영

## 3. 준영속 상태 (Detached)

### 정의

- 영속성 컨텍스트에서 분리된 상태
- 더 이상 영속성 컨텍스트가 관리하지 않는 상태

### 전환 방법

```java
// 준영속 상태로 만드는 방법들
// 1. detach() 메서드 사용
entityManager.detach(member);

// 2. clear() 메서드 - 영속성 컨텍스트 전체 초기화
entityManager.clear();

// 3. close() 메서드 - 영속성 컨텍스트 종료
entityManager.close();
```

### 특징

- 변경 감지 대상에서 제외
- 데이터베이스 반영 안 됨
- 다시 영속 상태로 만들려면 merge() 사용

## 4. 삭제 상태 (Removed)

### 정의

- 데이터베이스에서 삭제될 예정인 상태
- 영속성 컨텍스트와 데이터베이스에서 완전히 삭제

### 예시 코드

```java
// 삭제 상태로 전환
entityManager.remove(member);
```

## 상태 변화 예시

```java
public void entityLifecycleDemo() {
    EntityManager entityManager = entityManagerFactory.createEntityManager();
    EntityTransaction transaction = entityManager.getTransaction();

    transaction.begin();

    // 1. 비영속 상태
    Member member = new Member();
    member.setName("테스트 사용자");

    // 2. 영속 상태 - 영속성 컨텍스트에 저장
    entityManager.persist(member);

    // 3. 준영속 상태 - 영속성 컨텍스트에서 분리
    entityManager.detach(member);

    // 4. 삭제 상태
    entityManager.remove(member);

    transaction.commit();
}
```

## 주의사항

### 성능과 메모리 관리

- 불필요하게 많은 엔티티를 영속 상태로 유지하면 메모리 부하 발생
- 대량 데이터 처리 시 `clear()` 또는 `flush()` 메서드 적절히 사용

### 트랜잭션 관리

- 엔티티 상태 변경은 트랜잭션 범위 내에서 수행
- 트랜잭션 경계 관리에 주의

## 결론

엔티티 생명주기를 이해하고 적절히 관리하는 것은 JPA를 효과적으로 사용하는 핵심입니다. 각 상태의 특징을 잘 활용하면 더 효율적인 데이터 처리가 가능합니다.