 
## 트랜잭션 전파란?

트랜잭션 전파는 여러 트랜잭션 메서드가 호출될 때 트랜잭션을 어떻게 다룰 것인지 결정하는 방식입니다.

### 주요 목적

- 메서드 간 트랜잭션 동작 제어
- 복잡한 비즈니스 로직에서 트랜잭션 관리의 유연성 제공

## 스프링 트랜잭션 전파 옵션

### 1. REQUIRED (기본값)

```java
@Transactional(propagation = Propagation.REQUIRED)
public void mainMethod() {
    // 기존 트랜잭션이 있으면 그 트랜잭션에 참여
    // 없으면 새로운 트랜잭션 시작
    subMethod(); // 현재 트랜잭션 사용
}

@Transactional(propagation = Propagation.REQUIRED)
public void subMethod() {
    // mainMethod의 트랜잭션에 참여
}
```

### 2. REQUIRES_NEW
```java
@Transactional(propagation = Propagation.REQUIRES_NEW)
public void mainMethod() {
    // 새로운 트랜잭션 시작
    subMethod(); // 새로운 독립된 트랜잭션 생성
}

@Transactional(propagation = Propagation.REQUIRES_NEW)
public void subMethod() {
    // 항상 새로운 트랜잭션 시작
    // 기존 트랜잭션 있으면 일시 중단
}
```

### 3. NESTED
```java
@Transactional(propagation = Propagation.NESTED)
public void mainMethod() {
    // 부모 트랜잭션 내에 중첩된 트랜잭션 생성
    subMethod(); // 부모 트랜잭션에 종속된 중첩 트랜잭션
}

@Transactional(propagation = Propagation.NESTED)
public void subMethod() {
    // 부모 트랜잭션의 savepoint 생성
    // 부분적으로만 롤백 가능
}
```

### 4. MANDATORY
```java
@Transactional(propagation = Propagation.MANDATORY)
public void mandatoryMethod() {
    // 반드시 기존 트랜잭션이 존재해야 함
    // 없으면 예외 발생
}
```

### 5. SUPPORTS

```java
@Transactional(propagation = Propagation.SUPPORTS)
public void supportsMethod() {
    // 트랜잭션 있으면 참여
    // 없으면 트랜잭션 없이 실행
}
```

### 6. NOT_SUPPORTED

```java
@Transactional(propagation = Propagation.NOT_SUPPORTED)
public void notSupportedMethod() {
    // 트랜잭션 있으면 일시 중단
    // 트랜잭션 없이 실행
}
```

### 7. NEVER

```java
@Transactional(propagation = Propagation.NEVER)
public void neverMethod() {
    // 트랜잭션 존재하면 예외 발생
    // 트랜잭션 없는 상태에서만 실행
}
```

## 실제 사용 예시

```java
@Service
public class OrderService {
    @Autowired
    private PaymentService paymentService;
    
    @Transactional
    public void createOrder(Order order) {
        // 주문 생성
        orderRepository.save(order);
        
        // 결제 처리 - 독립된 트랜잭션
        paymentService.processPayment(order);
    }
}

@Service
public class PaymentService {
    @Transactional(propagation = Propagation.REQUIRES_NEW)
    public void processPayment(Order order) {
        // 주문의 트랜잭션과 별개로 처리
        // 실패해도 주문 트랜잭션에 영향 없음
        paymentRepository.save(new Payment(order));
    }
}
```

## 주의사항

### 성능 고려

- REQUIRES_NEW는 새로운 데이터베이스 커넥션 사용
- 과도한 사용 시 성능 저하 가능

### 트랜잭션 관리의 복잡성

- 너무 많은 전파 옵션 사용은 코드 복잡성 증가
- 간단하고 명확한 트랜잭션 설계 권장

### 예외 처리

- 각 전파 옵션에 따라 예외 처리 방식 다름
- 롤백 범위와 전파 방식 신중하게 설계

## 결론

트랜잭션 전파는 복잡한 비즈니스 로직에서 트랜잭션을 유연하게 관리할 수 있게 해줍니다. 하지만 과도한 사용은 오히려 코드의 가독성과 성능을 저하시킬 수 있으므로 신중하게 접근해야 합니다.