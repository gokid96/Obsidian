

## 인프라 구성

```
┌─────────────┐
│    사용자    │
└──────┬──────┘
       │
       ▼
┌─────────────────────────────────┐
│           Cloudflare            │
│         (DNS Only 모드)          │
├─────────────────────────────────┤
│ untitles.net → Vercel           │
│ api.untitles.net → 54.180.22.117 (AWS EC2)
│ images.untitles.net → R2 (Cloudflare)
└──────┬──────────────────────────┘
       │
       ▼
┌──────────┬──────────┬──────────┐
│  Vercel  │ AWS EC2  │    R2    │
│ 프론트엔드 │  백엔드   │  이미지   │
│          │ + Caddy  │          │
│          │ (SSL)    │          │
└──────────┴──────────┴──────────┘
```

---

## 도메인 구성

| 도메인                 | 대상                  | 프록시 | SSL                   |
| ------------------- | ------------------- | --- | --------------------- |
| untitles.net        | Vercel              | OFF | Vercel 자체             |
| api.untitles.net    | EC2 (54.180.22.117) | OFF | Caddy (Let's Encrypt) |
| images.untitles.net | Cloudflare R2       | -   | Cloudflare            |

---

## 요청 흐름

1. `untitles.net` 접속 → Vercel에서 프론트엔드 로드
2. 로그인/API 호출 → `api.untitles.net` → Caddy(SSL) → Docker 컨테이너(8070)
3. 이미지 업로드 → 프론트 → EC2 → R2 저장 → DB에 URL 저장
4. 이미지 조회 → `images.untitles.net` → R2 직접 반환

---

## 배포 구조

### 프론트엔드 (Vercel)
- GitHub 연동 자동 배포
- `untitles-web` 레포지토리

### 백엔드 (AWS EC2)
- GitHub Actions CI/CD
- Docker 컨테이너 (ghcr.io/gokid96/untitles-api)
- Caddy 리버스 프록시 (자동 SSL)

```
GitHub Push → GitHub Actions → Docker Build → GHCR Push → EC2 SSH → Docker Pull & Run
```

---

## EC2 구성

| 항목 | 값 |
|------|----|
| 인스턴스 타입 | t3.small |
| AMI | Ubuntu 24.04 LTS |
| 스토리지 | 30GB gp3 |
| 탄력적 IP | 54.180.22.117 |
| 리전 | ap-northeast-2 (서울) |

### 실행 중인 서비스
- Docker (untitles-api 컨테이너, 포트 8070)
- Caddy (리버스 프록시, 포트 443)